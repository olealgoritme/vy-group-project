__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=k(r(d[0])),n=r(d[1]),o=r(d[2]),s=C(r(d[3])),l=r(d[4]),u=r(d[5]),p=r(d[6]),c=r(d[7]),f=r(d[8]),v=k(r(d[9])),y=C(r(d[10])),h=C(r(d[11])),P=C(r(d[12])),b=C(r(d[13])),T=C(r(d[14]));function C(t){return t&&t.__esModule?t:{default:t}}function O(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return O=function(){return t},t}function k(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=O();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function E(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function I(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&M(t,n)}function M(t,n){return(M=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var j=(function(y){function C(t){var n,o,s;return w(this,C),o=this,(n=!(s=_(C).call(this,t))||"object"!=typeof s&&"function"!=typeof s?N(o):s).changeCurrentTime=n.changeCurrentTime.bind(N(n)),n.getReceiptParams=n.getReceiptParams.bind(N(n)),n.navigateToReceipt=n.navigateToReceipt.bind(N(n)),n.navigateToNetsTerminal=n.navigateToNetsTerminal.bind(N(n)),n.handleCaptureFailed=n.handleCaptureFailed.bind(N(n)),n.handleBuyButtonPressed=n.handleBuyButtonPressed.bind(N(n)),n}var O,k,M;return I(C,t.Component),O=C,(k=[{key:"componentDidMount",value:function(){var t=this,n=this.props.navigation.state.params.orderId;this.props.onGetOrder(n),this.props.navigation.setParams({handleOnClose:function(){return t.props.handleOnClose(function(){return t.props.navigation.goBack(null)})}})}},{key:"handleBuyButtonPressed",value:function(){var t,n,o,s=this,l=null==(t=this.props.order)?void 0:null==(n=t.periodTickets[0])?void 0:null==(o=n.priceOptions[0])?void 0:o.amountInOere;this.props.onHandlePayment(l,function(t){s.navigateToReceipt(t)},this.navigateToNetsTerminal);var p=this.props.navigation.state.params.orderToSave;if(p){var c=p.operator,f=p.ticketType,v=p.from,y=p.to,h=p.passengers,P=p.passengerString,b=p.duration,T=p.viaZone,C=p.periodString;(0,u.setOrderRecentOrders)(c,f,v,y,h,P,b,T,C)}}},{key:"navigateToReceipt",value:function(t){var n;this.props.order&&((0,c.trackPaymentFlowSilently)({source:'MOVING_TO_RECEIPT',orderId:null==(n=this.props.order)?void 0:n.id,message:"paymentType: "+(t||'UNKNOWN')}),this.props.navigation.navigate('Receipt',this.getReceiptParams(t)))}},{key:"navigateToNetsTerminal",value:function(t){this.props.order&&this.props.navigation.navigate('NetsTerminal',{url:t,receiptParams:this.getReceiptParams('CARD')})}},{key:"getReceiptParams",value:function(t){var n,o=this,s=this.props.navigation.state.params,l=s.previousStack,u=s.operator,p=s.from,c=s.to;return{activeTabIndex:1,orderId:null==(n=this.props.order)?void 0:n.id,onCaptureFailed:function(n){return o.handleCaptureFailed(n,t)},previousStack:l,operator:u,from:p,to:c}}},{key:"handleCaptureFailed",value:function(t,n){var s,l=(0,p.getMessageFromErrorIfPresent)(t)||(0,T.default)('capture_failed_generic_message'),u=o.NavigationActions.navigate({routeName:'PeriodTicketOrderConfirmation',key:this.props.navigation.state.key});this.props.navigation.dispatch(u),this.props.onHandleSetErrorMessage(l);var f=(n||'UNKNOWN')+"_CAPTURE_FAILED";(0,c.trackPaymentFlowSilently)({orderId:null==(s=this.props.order)?void 0:s.id,error:'Error presented to user: '+l,source:f})}},{key:"changeCurrentTime",value:function(t){var n=this.props.navigation.state.params.orderId;this.props.onChangeTimePeriodTicket(n,t)}},{key:"render",value:function(){var o,u,p,c=this.props.navigation.state.params.order,y=this.props,C=y.order,O=y.paymentMethods,k=y.selectedPaymentMethodIndex,w=y.isCreatingOrder,E=y.isInitiatingPayment,_=y.isCheckingVippsPaymentStatus,N=y.isPerformingVippsPayment,I=y.storeNewPaymentCard,M=y.isAdministratingCards,j=y.errorMessage,S=y.onAdministratingCards,R=y.onHandleDeleteCard,B=y.onHandleStoreNewPaymentCardPressed,F=y.onHandlePaymentMethodClicked,V=null!=(o=null==C?void 0:null==(u=C.periodTickets)?void 0:u[0])?o:c.periodTickets[0],A=w||M||E||N,D=null==C?void 0:null==(p=C.itineraries)?void 0:p.map(function(t){return t.legs.map(function(t){return t.operator})}).reduce(function(t,n){return t.concat(n)},[]);return t.createElement(l.ScreenView,null,t.createElement(n.ScrollView,{style:{backgroundColor:f.colors.brightGrey},contentContainerStyle:{justifyContent:'space-between',paddingBottom:100}},t.createElement(b.default,{changeCurrentTime:this.changeCurrentTime,currentTime:(0,s.default)(null==C?void 0:C.periodTickets[0].validFrom),product:V,operators:D}),t.createElement(n.View,{style:{paddingHorizontal:24,marginBottom:24}},t.createElement(P.default,null)),w?t.createElement(n.View,{style:{marginTop:30,alignSelf:'center',flex:1}},t.createElement(l.ActivityDotsIndicator,null)):t.createElement(h.default,{paymentMethods:O,selectedIndex:k,isAdministratingCards:M,onDeleteCardPressed:R,toggleAdministratingCards:S,storeNewPaymentCard:I,onStoreNewPaymentCardPressed:B,onPaymentMethodPressed:function(t){return F(t)}})),t.createElement(v.default,{animated:!0,style:{marginBottom:24,marginHorizontal:24,position:'absolute',bottom:0},message:j?(0,v.warnMessage)(j):void 0}),t.createElement(l.ModalBottomButton,{loading:!!C&&!M&&!N,onPress:this.handleBuyButtonPressed,disabled:A,text:(0,T.default)('buy_order')}),t.createElement(l.FadedOverlay,{isVisible:N},t.createElement(n.View,{style:{height:'40%'}},t.createElement(n.View,{style:{padding:12}},t.createElement(l.LargeText,{center:!0},(0,T.default)('performing_vipps_payment'))),t.createElement(n.View,{style:{flex:1,alignItems:'center',justifyContent:'center'}},_&&t.createElement(l.ActivityDotsIndicator,null)))))}}])&&E(O.prototype,k),M&&E(O,M),C})(),S=(0,y.default)(j);e.default=S},1922,[7,10,435,628,653,640,636,642,414,1487,1910,1726,1724,1923,1925]);