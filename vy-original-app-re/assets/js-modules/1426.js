__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.OfflineModuleEventEmitter=void 0;var t=r(d[0]),n=r(d[1]),s=u(r(d[2])),o=u(r(d[3]));function u(t){return t&&t.__esModule?t:{default:t}}function c(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function l(t,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var f=t.NativeModules.MGLModule,h=t.NativeModules.MGLOfflineModule,k=new t.NativeEventEmitter(h);e.OfflineModuleEventEmitter=k;var p=new((function(){function t(){c(this,t),this._hasInitialized=!1,this._offlinePacks={},this._progressListeners={},this._errorListeners={},this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this)}var u,p,_;return u=t,(p=[{key:"createPack",value:function(t,n,u){var c,l;return regeneratorRuntime.async(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,regeneratorRuntime.awrap(this._initialize());case 2:if(c=new s.default(t),!this._offlinePacks[c.name]){f.next=5;break}throw new Error("Offline pack with name "+c.name+" already exists.");case 5:return this.subscribe(c.name,n,u),f.next=8,regeneratorRuntime.awrap(h.createPack(c));case 8:l=f.sent,this._offlinePacks[c.name]=new o.default(l);case 10:case"end":return f.stop()}},null,this)}},{key:"deletePack",value:function(t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,regeneratorRuntime.awrap(this._initialize());case 4:if(!this._offlinePacks[t]){n.next=9;break}return n.next=8,regeneratorRuntime.awrap(h.deletePack(t));case 8:delete this._offlinePacks[t];case 9:case"end":return n.stop()}},null,this)}},{key:"getPacks",value:function(){var t=this;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(this._initialize());case 2:return n.abrupt("return",Object.keys(this._offlinePacks).map(function(n){return t._offlinePacks[n]}));case 3:case"end":return n.stop()}},null,this)}},{key:"getPack",value:function(t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(this._initialize());case 2:return n.abrupt("return",this._offlinePacks[t]);case 3:case"end":return n.stop()}},null,this)}},{key:"setTileCountLimit",value:function(t){h.setTileCountLimit(t)}},{key:"setProgressEventThrottle",value:function(t){h.setProgressEventThrottle(t)}},{key:"subscribe",value:function(t,s,o){var u,c;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:if(u=Object.keys(this._progressListeners).length,(0,n.isFunction)(s)&&(0===u&&k.addListener(f.OfflineCallbackName.Progress,this._onProgress),this._progressListeners[t]=s),c=Object.keys(this._errorListeners).length,(0,n.isFunction)(o)&&(0===c&&k.addListener(f.OfflineCallbackName.Error,this._onError),this._errorListeners[t]=o),!(0,n.isAndroid)()||!this._offlinePacks[t]){l.next=13;break}return l.prev=5,l.next=8,regeneratorRuntime.awrap(h.setPackObserver(t));case 8:l.next=13;break;case 10:l.prev=10,l.t0=l.catch(5),console.log('Unable to set pack observer',l.t0);case 13:case"end":return l.stop()}},null,this,[[5,10]])}},{key:"unsubscribe",value:function(t){delete this._progressListeners[t],delete this._errorListeners[t],0===Object.keys(this._progressListeners).length&&k.removeListener(f.OfflineCallbackName.Progress,this._onProgress),0===Object.keys(this._errorListeners).length&&k.removeListener(f.OfflineCallbackName.Error,this._onError)}},{key:"_initialize",value:function(){var t=this;return new Promise(function(n,s){var u,c,l,f,k,p,_;return regeneratorRuntime.async(function(b){for(;;)switch(b.prev=b.next){case 0:if(!t._hasInitialized){b.next=2;break}return b.abrupt("return",n(!0));case 2:return b.prev=2,b.next=5,regeneratorRuntime.awrap(h.getPacks());case 5:u=b.sent,c=u,l=Array.isArray(c),f=0,c=l?c:c["function"==typeof Symbol&&"function"==typeof Symbol?Symbol.iterator:"@@iterator"]();case 7:if(!l){b.next=13;break}if(!(f>=c.length)){b.next=10;break}return b.abrupt("break",22);case 10:k=c[f++],b.next=17;break;case 13:if(!(f=c.next()).done){b.next=16;break}return b.abrupt("break",22);case 16:k=f.value;case 17:p=k,_=new o.default(p),t._offlinePacks[_.name]=_;case 20:b.next=7;break;case 22:b.next=28;break;case 24:return b.prev=24,b.t0=b.catch(2),s(b.t0),b.abrupt("return");case 28:return t._hasInitialized=!0,b.abrupt("return",n(!0));case 30:case"end":return b.stop()}},null,null,[[2,24]])})}},{key:"_onProgress",value:function(t){var n=t.payload,s=n.name,o=n.state;if(this._hasListeners(s,this._progressListeners)){var u=this._offlinePacks[s];this._progressListeners[s](u,t.payload),o===f.OfflinePackDownloadState.Complete&&this.unsubscribe(s)}}},{key:"_onError",value:function(t){var n=t.payload.name;if(this._hasListeners(n,this._errorListeners)){var s=this._offlinePacks[n];this._errorListeners[n](s,t.payload)}}},{key:"_hasListeners",value:function(t,s){return!(0,n.isUndefined)(this._offlinePacks[t])&&(0,n.isFunction)(s[t])}}])&&l(u.prototype,p),_&&l(u,_),t})());e.default=p},1426,[10,1402,1427,1428]);