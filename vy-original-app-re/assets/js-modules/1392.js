__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=F();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var u=s?Object.getOwnPropertyDescriptor(t,c):null;u&&(u.get||u.set)?Object.defineProperty(o,c,u):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),c=M(r(d[4])),u=r(d[5]),l=r(d[6]),h=M(r(d[7])),f=r(d[8]),S=r(d[9]),v=r(d[10]),p=r(d[11]),y=M(r(d[12])),T=M(r(d[13])),b=r(d[14]),w=M(r(d[15])),k=M(r(d[16])),P=r(d[17]),R=r(d[18]),O=r(d[19]);function M(t){return t&&t.__esModule?t:{default:t}}function F(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return F=function(){return t},t}function _(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function E(t){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function x(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}function B(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function j(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function C(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&L(t,n)}function L(t,n){return(L=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var N=(function(M){function F(t){var n,o,s;return B(this,F),o=this,(n=!(s=D(F).call(this,t))||"object"!=typeof s&&"function"!=typeof s?A(o):s).state={stations:[],favoriteStations:[],recentSearch:[],featureToggles:void 0,isFetchingStations:!0,tickerMessages:void 0,betaToggleOn:!1,useBetaTravelPlanner:!1,isSwitchingTravelPlanner:!1},n.onStationSelectFinished=n.onStationSelectFinished.bind(A(n)),n.handleSwitchSearchMode=n.handleSwitchSearchMode.bind(A(n)),n.getFeatureToggles=n.getFeatureToggles.bind(A(n)),n.onTravelPlannerSearchSubmit=n.onTravelPlannerSearchSubmit.bind(A(n)),n}var L,N,W;return C(F,t.Component),L=F,(N=[{key:"componentDidMount",value:function(){this.getStations(),this.getShortcuts(),this.getFeatureToggles(),this.getRecentSearchMode()}},{key:"componentDidUpdate",value:function(t){!t.isFocused&&this.props.isFocused&&this.getShortcuts()}},{key:"getStations",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap((0,u.getStationsListFromCacheThenRemote)());case 3:t=n.sent,this.setStations(t),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.log('Something failed while retrieving stations with error:',n.t0);case 10:case"end":return n.stop()}},null,this,[[0,7]])}},{key:"getShortcuts",value:function(){var t,n;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return t=[this.getFavorites(),(0,v.getRecentSearch)()],o.next=3,regeneratorRuntime.awrap(Promise.all(t.map(function(t,n){return t.catch(function(t){console.log("Failed to retrieve shortcut for index "+n+": "+t)})})));case 3:n=o.sent,this.setShortcuts.apply(this,x(s=n)||E(s)||_());case 5:case"end":return o.stop()}var s},null,this)}},{key:"getFeatureToggles",value:function(){var t,n,o=this;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,regeneratorRuntime.awrap((0,p.getFeatureToggles)());case 2:return t=s.sent,s.next=5,regeneratorRuntime.awrap((0,b.getBetaToggles)());case 5:n=s.sent,this.setState({featureToggles:t,betaToggleOn:n.useTravelPlanner},function(){o.state.featureToggles&&o.state.featureToggles.showTickerMessages&&o.getTickerMessages()});case 7:case"end":return s.stop()}},null,this)}},{key:"getRecentSearchMode",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap((0,P.getRecentSearchMode)());case 2:t=n.sent,n.t0=t,n.next='Beta'===n.t0?6:'Regular'===n.t0?8:10;break;case 6:return this.setState({useBetaTravelPlanner:!0}),n.abrupt("break",11);case 8:return this.setState({useBetaTravelPlanner:!1}),n.abrupt("break",11);case 10:this.setState({useBetaTravelPlanner:!1});case 11:case"end":return n.stop()}},null,this)}},{key:"getTickerMessages",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap((0,l.getTickerMessagesFromCacheOrRemote)());case 2:t=n.sent,this.setState({tickerMessages:t});case 4:case"end":return n.stop()}},null,this)}},{key:"getFavorites",value:function(){var t,n,o=this;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,regeneratorRuntime.awrap((0,l.getFavoritesFromCacheThenRemote)());case 2:return t=s.sent,n=t.map(function(t){return[t.from,t.to]}).reduce(function(t,n){return t.concat(n)},[]).map(function(t){return o.state.stations.find(function(n){return n.id===t.code})}).filter(Boolean),s.abrupt("return",(0,S.removeDuplicates)(n,'name'));case 5:case"end":return s.stop()}})}},{key:"setStations",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length||n.Alert.alert((0,T.default)('no_stations_found_alert')),this.setState({stations:t.length?(0,f.sortStations)(t):t,isFetchingStations:!1})}},{key:"onDeleteStation",value:function(t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap((0,v.deleteStationFromRecentSearch)(t));case 2:y.default.DELETE_RECENT_SEARCH_STATION({station:t.name}),this.getShortcuts();case 4:case"end":return n.stop()}},null,this)}},{key:"setShortcuts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.setState({favoriteStations:t,recentSearch:n})}},{key:"onStationSelectFinished",value:function(t){n.Keyboard.dismiss();var o=t.from,s=t.to;(0,O.isBusStations)(o,s)&&y.default.BUS_SEARCH({from:o.name,to:s.name}),(0,v.setRecentSearch)(t),this.props.navigation.navigate('DateTimeSelection',{from:o,to:s})}},{key:"handleSwitchSearchMode",value:function(){var t=this.state.useBetaTravelPlanner,n=this.state.betaToggleOn;this.setState(function(t){return{useBetaTravelPlanner:!t.useBetaTravelPlanner}},function(){!t&&n?(0,P.setRecentSearchMode)('Beta'):(0,P.setRecentSearchMode)('Regular')}),this.showLoadingScreenWhenSwitchingSearchMode()}},{key:"showLoadingScreenWhenSwitchingSearchMode",value:function(){var t=this;this.setState({isSwitchingTravelPlanner:!0}),setTimeout(function(){t.setState({isSwitchingTravelPlanner:!1})},1500)}},{key:"onTravelPlannerSearchSubmit",value:function(t,n,o,s){var c={from:t,to:n,selectedTime:o,passengers:s};this.props.navigation.dispatch((0,R.navigateToScreen)(c))}},{key:"render",value:function(){var u=this;return this.state.isSwitchingTravelPlanner?t.default.createElement(w.default,{searchModeIsBeta:this.state.useBetaTravelPlanner}):this.state.betaToggleOn&&this.state.useBetaTravelPlanner?t.default.createElement(k.default,{onSwitchSearchMode:this.handleSwitchSearchMode,onTravelPlannerSearchSubmit:this.onTravelPlannerSearchSubmit}):t.default.createElement(s.ScreenView,{style:{flex:1}},t.default.createElement(h.default,{toActive:function(){u.getShortcuts()}}),t.default.createElement(o.NavigationEvents,{onDidFocus:this.getFeatureToggles}),t.default.createElement(n.SafeAreaView,null,t.default.createElement(n.ScrollView,{contentContainerStyle:{paddingBottom:100},scrollEventThrottle:16,keyboardShouldPersistTaps:"always",onScrollBeginDrag:function(){return n.Keyboard.dismiss()}},t.default.createElement(c.default,{navigation:this.props.navigation,stations:this.state.stations,isFetchingStations:this.state.isFetchingStations,favoriteStations:this.state.favoriteStations,recentSearch:this.state.recentSearch,featureToggles:this.state.featureToggles,betaToggleOn:this.state.betaToggleOn,onSwitchSearchMode:this.handleSwitchSearchMode,onStationSelectFinished:this.onStationSelectFinished,onDeleteStation:function(t){return u.onDeleteStation(t)},tickerMessages:this.state.tickerMessages}))))}}])&&j(L.prototype,N),W&&j(L,W),F})();N.navigationOptions=function(){return{header:null}};var W=(0,o.withNavigationFocus)(N);e.default=W},1392,[7,10,435,653,1393,625,616,1455,1446,619,645,647,1294,1234,1462,1463,1464,1467,1332,1331]);