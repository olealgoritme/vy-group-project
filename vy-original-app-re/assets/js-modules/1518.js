__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=S();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var c=s?Object.getOwnPropertyDescriptor(t,u):null;c&&(c.get||c.set)?Object.defineProperty(o,u,c):o[u]=t[u]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=b(r(d[2])),s=r(d[3]),u=b(r(d[4])),c=r(d[5]),l=r(d[6]),p=r(d[7]),f=r(d[8]),h=b(r(d[9])),v=b(r(d[10])),P=b(r(d[11])),y=b(r(d[12]));function b(t){return t&&t.__esModule?t:{default:t}}function S(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return S=function(){return t},t}function O(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function C(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&Z(t,n)}function Z(t,n){return(Z=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var _={container:{marginTop:18,flexDirection:'row',justifyContent:'space-between',alignItems:'center',marginBottom:12}},E=(function(b){function S(t){var n,o,s;return O(this,S),o=this,(n=!(s=T(S).call(this,t))||"object"!=typeof s&&"function"!=typeof s?V(o):s).state={isLoadingProducts:!1,currentProduct:void 0,products:[],passengers:[],passengerCategories:[],currentViaZone:void 0,availableViaZones:[],productMessages:[]},n.changeCurrentProduct=n.changeCurrentProduct.bind(V(n)),n.changePassengers=n.changePassengers.bind(V(n)),n.changeCurrentViaZone=n.changeCurrentViaZone.bind(V(n)),n.filterProducts=n.filterProducts.bind(V(n)),n.handleContinueToPaymentPress=n.handleContinueToPaymentPress.bind(V(n)),n.orderToSave=n.orderToSave.bind(V(n)),n}var Z,E,k;return w(S,t.Component),Z=S,(E=[{key:"componentDidUpdate",value:function(t,n){var o=this.props,s=o.fromStop,u=o.toStop;s&&u&&(t.fromStop!==s||t.toStop!==u)&&(this.getProducts(),this.setState({currentViaZone:void 0}))}},{key:"getProducts",value:function(){var t,n,o,s,u,c,p,h,v,P,b=this;return regeneratorRuntime.async(function(S){for(;;)switch(S.prev=S.next){case 0:if(t=this.state.passengers,n=this.props,o=n.operator,s=n.fromStop,u=n.toStop,s&&u){S.next=4;break}return S.abrupt("return");case 4:return this.setState({isLoadingProducts:!0,currentProduct:void 0}),S.prev=5,c=new Date,S.next=9,regeneratorRuntime.awrap((0,l.fetchLocalOperatorSingleTicketProducts)(s.id,u.id,o,t.length?t:void 0));case 9:p=S.sent,h=new Date-c,v=h<=750?750-h:0,this.setProducts(p),setTimeout(function(){return b.setState({isLoadingProducts:!1})},v),S.next=20;break;case 16:S.prev=16,S.t0=S.catch(5),P=(0,f.getMessageFromErrorIfPresent)(S.t0)||(0,y.default)('no_products_found'),this.setState({isLoadingProducts:!1,productMessages:[{text:P,type:'ERROR'}]});case 20:case"end":return S.stop()}},null,this,[[5,16]])}},{key:"setProducts",value:function(t){var n=this;this.setState({currentProduct:t.products[0],products:t.products,passengers:t.passengerInformation.passengers,passengerCategories:t.passengerInformation.availableCategories,productMessages:t.messages},this.filterProducts),t.availableViaZones.length===t.availableViaZones.filter(function(t){return n.state.availableViaZones&&n.state.availableViaZones.some(function(n){return t.zoneId===n.zoneId})}).length||this.setState({availableViaZones:t.availableViaZones,currentViaZone:void 0})}},{key:"changeCurrentProduct",value:function(t){this.setState({currentProduct:t})}},{key:"changePassengers",value:function(t){var n=this;this.setState({passengers:t},function(){return n.getProducts()})}},{key:"changeCurrentViaZone",value:function(t){this.setState({currentViaZone:t},this.filterProducts)}},{key:"filterProducts",value:function(){var t=this.state,n=t.currentViaZone,o=t.currentProduct,s=t.products,u=n?s.filter(function(t){var o;return(null==(o=t.zoneData.viaZone)?void 0:o.zoneId)===n.zoneId}):s;u.length&&!u.some(function(t){return t.id===(null==o?void 0:o.id)})&&this.changeCurrentProduct(u[0])}},{key:"orderToSave",value:function(t){var n=this.props,o=n.operator,s=n.fromStop,u=n.toStop,l=this.state,p=l.passengers,f=l.passengerCategories,h=(0,c.getPassengerSelectionSummary)(p,f);if(s&&u&&t)return{operator:o,ticketType:'SINGLE_TICKET',from:s,to:u,passengers:p,passengerString:h,duration:t.duration,viaZone:t.zoneData.viaZone}}},{key:"handleContinueToPaymentPress",value:function(){this.props.navigateToOrderConfirmation(this.state.currentProduct,this.orderToSave(this.state.currentProduct)),o.default.RUTER_CONTINUE_TO_PAYMENT({from:'Single Ticket',operator:this.props.operator})}},{key:"render",value:function(){var o,c,l=this.state,f=l.currentProduct,b=l.isLoadingProducts,S=l.currentViaZone,O=l.availableViaZones,C=l.passengers,T=l.passengerCategories,V=l.productMessages,w=this.props,Z=w.isCreatingOrder,E=w.operator,k=w.fromStop,j=w.toStop,I=w.changeStop,D=w.flipDirection,M=(0,p.getAmountFromOereWithCurrency)(null==f?void 0:null==(o=f.priceOptions[0])?void 0:o.amountInOere);return t.createElement(n.View,{style:{flex:1}},t.createElement(n.ScrollView,{keyboardShouldPersistTaps:"always",contentContainerStyle:{paddingBottom:100}},t.createElement(v.default,{messages:V}),t.createElement(P.default,{useCurrentPosition:!0,toStop:j,fromStop:k,changeStop:I,flipDirection:D,availableViaZones:O,currentViaZone:S,changeCurrentViaZone:this.changeCurrentViaZone,operator:E}),t.createElement(n.View,{style:{marginHorizontal:24}},(null==C?void 0:C.length)>0&&(null==T?void 0:T.length)>0&&t.createElement(h.default,{passengers:C,passengerCategories:T,changePassengers:this.changePassengers}),!b&&(null==f?void 0:null==(c=f.priceOptions[0])?void 0:c.amountInOere)&&t.createElement(n.View,{style:_.container},t.createElement(s.SmallText,null,(0,y.default)('price')+':'),t.createElement(s.SmallTextBold,null,M)),b&&t.createElement(n.View,{style:{marginTop:24,alignItems:'center'}},t.createElement(s.ActivityDotsIndicator,{style:{marginLeft:-8}})))),t.createElement(u.default,{loading:Z,onPress:this.handleContinueToPaymentPress,disabled:!f||Z,containerStyle:{margin:18}},(0,y.default)('go_to_payment')))}}])&&C(Z.prototype,E),k&&C(Z,k),S})();e.default=E},1518,[7,10,1294,653,986,1296,642,1236,636,1519,1521,1522,1472]);