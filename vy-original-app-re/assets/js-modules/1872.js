__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.navigateToScreen=function(t){return n.NavigationActions.navigate({routeName:B,params:t})},e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=N();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var c=s?Object.getOwnPropertyDescriptor(t,u):null;c&&(c.get||c.set)?Object.defineProperty(o,u,c):o[u]=t[u]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),u=r(d[4]),c=r(d[5]),l=r(d[6]),p=r(d[7]),f=r(d[8]),v=r(d[9]),b=r(d[10]),h=x(r(d[11])),O=x(r(d[12])),y=x(r(d[13])),_=x(r(d[14])),P=x(r(d[15])),w=r(d[16]);function x(t){return t&&t.__esModule?t:{default:t}}function N(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return N=function(){return t},t}function S(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function k(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function I(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&C(t,n)}function C(t,n){return(C=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var j={contentContainer:{paddingTop:40,paddingBottom:30,paddingHorizontal:12}},B='PriceOptions';var R=(function(n){function u(t){var n,o,s;S(this,u),o=this,n=!(s=T(u).call(this,t))||"object"!=typeof s&&"function"!=typeof s?I(o):s;var c=t.navigation.state.params.itinerary.priceOptions.findIndex(function(t){return t.bookable&&0!==t.amountInOere})||0;return n.state={selectedPriceOptionIndex:c,isCreatingOrder:!1},n.navigateToNextScreen=n.navigateToNextScreen.bind(I(n)),n.navigateToNettbuss=n.navigateToNettbuss.bind(I(n)),n.renderPriceOption=n.renderPriceOption.bind(I(n)),n.createNewOrder=n.createNewOrder.bind(I(n)),n}var l,x,N;return E(u,t.Component),l=u,(x=[{key:"handlePriceOptionClicked",value:function(t){this.setState({selectedPriceOptionIndex:t})}},{key:"navigateToNextScreen",value:function(){var t,n,o,s,u;return regeneratorRuntime.async(function(c){for(;;)switch(c.prev=c.next){case 0:if(t=this.props.navigation.state.params,n=t.itinerary,o=t.previousStack,s=t.passengerSummary,!(n.useNewBusApi&&this.props.loginState.isLoggedIn)){c.next=9;break}return c.next=5,regeneratorRuntime.awrap(this.createNewOrder());case 5:u=c.sent,this.props.navigation.dispatch((0,p.navigateToNextBusOrderScreen)(u,o,s)),c.next=10;break;case 9:this.navigateToNettbuss();case 10:case"end":return c.stop()}},null,this)}},{key:"createNewOrder",value:function(){var t,n,s;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return t=this.props.navigation.state.params.itinerary,u.prev=1,this.setState({isCreatingOrder:!0}),u.next=5,regeneratorRuntime.awrap((0,c.createOrder)(t.turnitJourneyId,t.priceOptions[this.state.selectedPriceOptionIndex].type));case 5:return n=u.sent,s=n.id,u.next=9,regeneratorRuntime.awrap((0,c.getOrder)(s));case 9:return u.abrupt("return",u.sent);case 12:u.prev=12,u.t0=u.catch(1),o.Alert.alert((0,P.default)('order_or_payment_failed_alert_title'),(0,v.getMessageFromErrorIfPresent)(u.t0)||(0,P.default)('initiate_order_failed_generic_message'));case 15:return u.prev=15,this.setState({isCreatingOrder:!1}),u.finish(15);case 18:case"end":return u.stop()}},null,this,[[1,12,15,18]])}},{key:"navigateToNettbuss",value:function(){var t,n;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return t=this.props.navigation.state.params.itinerary,n=t.priceOptions[this.state.selectedPriceOptionIndex],s.prev=2,s.next=5,regeneratorRuntime.awrap(o.Linking.openURL(n.seatMapUrl));case 5:this.trackNavigateToNettbuss(),s.next=11;break;case 8:s.prev=8,s.t0=s.catch(2),o.Alert.alert((0,P.default)('bus_open_at_nettbuss_alert_title'),(0,P.default)('bus_open_at_nettbuss_alert_message'));case 11:case"end":return s.stop()}},null,this,[[2,8]])}},{key:"trackNavigateToNettbuss",value:function(){var t=this.props.navigation.state.params,n=t.from,o=t.to;h.default.NAVIGATE_TO_NETTBUSS({isBusStation:String((0,w.isBusStations)(n,o)),from:n.name,to:o.name})}},{key:"renderPriceOption",value:function(n){var o=this,s=n.item,u=n.index,c=this.props.navigation.state.params.itinerary,l=(0,f.getCheapestPriceOption)(c.priceOptions),p=s.amountInOere,v=s.amountOnBusInOere,b=s.bookable?p:(0,P.default)('bus_not_available'),h=s.sellingPoints.reduce(function(t,n){var o=n.included?(0,P.default)('included'):(0,P.default)('not_included');return t+(n.text+': '+o+'. ')},'')||'',O=(0,P.default)('accessibility_price_option')+': '+s.displayName+'. '+(0,P.default)('ticket_price')+': '+b+'. '+(0,P.default)('selling_points')+': '+h;return t.default.createElement(_.default,{onPress:function(){return o.handlePriceOptionClicked(u)},accessibilityLabel:O,isUnavailable:!s.bookable,unavailableReason:(0,P.default)('bus_not_available'),isActive:u===this.state.selectedPriceOptionIndex,isCheapestOption:s===l,description:s.displayName,tagline:(0,P.default)('bus_tagline'),sellingPoints:s.sellingPoints||[],price:p,priceOnBus:v})}},{key:"render",value:function(){var n=this.props.navigation.state.params,u=n.itinerary,c=n.passengerSummary,l=u.priceOptions[this.state.selectedPriceOptionIndex],p=u.useNewBusApi&&this.props.loginState.isLoggedIn;return t.default.createElement(t.default.Fragment,null,t.default.createElement(o.View,{style:{zIndex:10}},t.default.createElement(s.HeaderCard,null,t.default.createElement(O.default,{showBackButton:!0,showCloseButton:!0,showVerticalLine:!0,headerText:(0,P.default)('price_options')}))),t.default.createElement(o.FlatList,{contentContainerStyle:j.contentContainer,data:u.priceOptions,extraData:this.state.selectedPriceOptionIndex,keyExtractor:function(t){return t.name},keyboardShouldPersistTaps:"always",renderItem:this.renderPriceOption}),t.default.createElement(y.default,{isLoading:this.state.isCreatingOrder,text:(0,P.default)(p?'go_further':'order_at_nettbuss'),buttonIconRight:!p&&b.leave,onPress:this.navigateToNextScreen},t.default.createElement(L,{chosenPriceOption:l,passengerSummary:c})))}}])&&k(l.prototype,x),N&&k(l,N),u})(),L=function(n){var u=n.passengerSummary,c=n.chosenPriceOption,p=(0,l.getAmountFromOereWithCurrency)(c.amountInOere),f=(0,P.default)('chosen_price_options')+': '+c.displayName+'. '+u+', '+p;return t.default.createElement(o.View,{accessible:!0,accessibilityRole:"summary",accessibilityLabel:f},t.default.createElement(s.SmallText,null,u),t.default.createElement(s.SmallTextBold,null,p))},A=(0,u.withLoginState)((0,n.withNavigation)(R));e.default=A},1872,[7,435,10,653,637,642,1236,1701,1228,636,675,1294,1715,1741,1873,1234,1331]);