__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=r(d[0]),n=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=A();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var c=s?Object.getOwnPropertyDescriptor(t,u):null;c&&(c.get||c.set)?Object.defineProperty(o,u,c):o[u]=t[u]}o.default=t,n&&n.set(t,o);return o})(r(d[1])),o=r(d[2]),s=_(r(d[3])),u=r(d[4]),c=r(d[5]),f=r(d[6]),l=_(r(d[7])),v=r(d[8]),p=r(d[9]),h=_(r(d[10])),b=_(r(d[11])),y=_(r(d[12])),F=_(r(d[13])),P=_(r(d[14])),k=r(d[15]),O=r(d[16]),T=r(d[17]),S=_(r(d[18])),w=_(r(d[19])),j=r(d[20]);function _(t){return t&&t.__esModule?t:{default:t}}function A(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return A=function(){return t},t}function C(t,n){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),o.push.apply(o,s)}return o}function D(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?C(Object(o),!0).forEach(function(n){R(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):C(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function R(t,n,o){return n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function E(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function I(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&M(t,n)}function M(t,n){return(M=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var x={duration:500,update:{type:t.LayoutAnimation.Types.spring,property:t.LayoutAnimation.Properties.opacity,springDamping:.65}},W=(function(o){function T(){var t,n,o,s;E(this,T);for(var u=arguments.length,c=new Array(u),f=0;f<u;f++)c[f]=arguments[f];return o=this,(n=!(s=(t=V(T)).call.apply(t,[this].concat(c)))||"object"!=typeof s&&"function"!=typeof s?H(o):s).state={favorites:[],subscriptions:[],loadingFavoritesFromCache:!0,loadingFavorites:!0,loadingSubscriptions:!0,refreshingFavorites:!1,refreshingSubscriptions:!1,userHasActivePeriodTicket:void 0},n}var j,_,A;return L(T,n.Component),j=T,(_=[{key:"componentDidUpdate",value:function(t,n){!t.isFocused&&this.props.isFocused&&this.handleOnRefresh()}},{key:"componentDidMount",value:function(){this.props.userProfile&&this.props.userProfile.userId&&(this.readFavoritesFromCacheBeforeRemote(),this.checkForActivePeriodTicket())}},{key:"handleOnRefresh",value:function(){var t=this;this.setState({refreshingFavorites:!0,refreshingSubscriptions:!0},function(){t.getFavorites(),t.getSubscriptions()})}},{key:"checkForActivePeriodTicket",value:function(){var t=this;(0,f.fetchUserHasValidPeriodTicket)().then(function(n){t.setState({userHasActivePeriodTicket:n.hasValidPeriodTicket||n.hasFuturePeriodTicket})}).catch(function(t){console.log('fetchUserHasValidPeriodTicket() failed')})}},{key:"readFavoritesFromCacheBeforeRemote",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap((0,O.getFavorites)());case 3:t=n.sent,this.setFavoritesFromCache(t),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.log('Failed while reading favorites from cache:',n.t0),this.setState({loadingFavoritesFromCache:!1});case 11:return n.prev=11,this.getFavorites(),this.getSubscriptions(),n.finish(11);case 15:case"end":return n.stop()}},null,this,[[0,7,11,15]])}},{key:"getFavorites",value:function(){var n=this;(0,u.fetchFavorites)().then(function(t){n.setFavorites(t)}).catch(function(n){t.Alert.alert((0,F.default)('fetch_favorites_failed'))}).done()}},{key:"getSubscriptions",value:function(){var n=this;(0,c.fetchSubscriptions)().then(function(t){return n.setSubscriptions(t)}).catch(function(n){t.Alert.alert((0,F.default)('fetch_subscriptions_failed'))}).done()}},{key:"setFavoritesFromCache",value:function(t){this.setState({favorites:t,loadingFavoritesFromCache:!1})}},{key:"setFavorites",value:function(n){t.LayoutAnimation.configureNext(x),this.setState({favorites:n,refreshingFavorites:!1,loadingFavorites:!1})}},{key:"setSubscriptions",value:function(t){this.setState({subscriptions:t,refreshingSubscriptions:!1,loadingSubscriptions:!1})}},{key:"deleteFavoriteHandler",value:function(t){var n=this,o=this.state.subscriptions.filter(function(n){return n.stationPairId===t.stationPairId})[0];o&&o.active?(0,v.disableSubscriptionAndDeleteFavoriteWithErrorHandling)({subscription:o,favorite:t,callback:function(){n.setFavorites(n.state.favorites.filter(function(n){return n.stationPairId!==t.stationPairId}))}}):(0,v.deleteFavoriteWithErrorHandling)({favorite:t,callback:function(){n.setFavorites(n.state.favorites.filter(function(n){return n.stationPairId!==t.stationPairId}))}})}},{key:"navigateToSubscriptionView",value:function(t){var n=this,o=t.subscription||(0,P.default)(t);this.props.navigation.navigate('SubscriptionSettings',{subscription:(0,p.deepClone)(o),onSave:function(){return n.getSubscriptions()},isNew:!t.subscription})}},{key:"navigateToPushRequiresTicket",value:function(t){this.props.navigation.navigate('PushRequiresTicket',{favorite:t})}},{key:"navigateToPushInfo",value:function(){this.props.navigation.navigate('PushInfo',{title:'',url:(0,F.default)('push_info_url')})}},{key:"navigateToAddFavorite",value:function(){this.props.navigation.navigate('AddFavorite')}},{key:"navigateToDepartures",value:function(t){S.default.FAVORITE_CLICKED({from:t.from.name,to:t.to.name}),this.props.navigation.navigate('FavoriteDepartures',{selectedTime:(0,s.default)(),from:{code:t.from.code,country:t.from.country,name:t.from.name},to:{code:t.to.code,country:t.to.country,name:t.to.name}})}},{key:"render",value:function(){var t=this,o=0===this.state.favorites.length;return n.default.createElement(y.default,{style:{backgroundColor:w.default.brightGrey}},q(this.state)?n.default.createElement(l.default,null):o?n.default.createElement(h.default,{navigateToAddFavorite:function(){return t.navigateToAddFavorite()}}):n.default.createElement(b.default,{deleteFavorite:function(n){return t.deleteFavoriteHandler(n)},favoritesWithSubscriptions:(0,k.mergeFavoritesAndSubscriptions)(this.state.favorites,this.state.subscriptions),isRefreshing:U(this.state),onRefresh:function(){return t.handleOnRefresh()},navigateToDepartures:function(n){return t.navigateToDepartures(n)},navigateToPushInfo:function(){return t.navigateToPushInfo()},userHasActivePeriodTicket:!0===this.state.userHasActivePeriodTicket,navigateToPushRequiresTicket:function(n){return t.navigateToPushRequiresTicket(n)},navigateToSubscriptionView:function(n){return t.navigateToSubscriptionView(n)},isLoadingDeparturesAndSubscriptions:this.state.loadingFavorites||this.state.loadingSubscriptions||void 0===this.state.userHasActivePeriodTicket}))}}])&&I(j.prototype,_),A&&I(j,A),T})(),q=function(t){return t.loadingFavorites&&t.loadingFavoritesFromCache||!t.loadingFavoritesFromCache&&!t.favorites.length&&t.loadingFavorites},U=function(t){return t.refreshingFavorites||t.refreshingSubscriptions},B=(0,o.withNavigationFocus)((0,j.withUserProfile)(W));B.navigationOptions=function(o){var s=o.navigation;return{headerTitle:(0,F.default)('title_bar'),headerTitleContainerStyle:D({},t.Platform.select({android:{left:0}})),headerRight:n.default.createElement(T.AddButton,{onPress:function(){return s.navigate('AddFavorite')},accessibilityLabel:(0,F.default)('add_new_favorite')})}};var N=B;e.default=N},1778,[10,7,435,628,616,1635,662,1184,1634,619,1779,1781,1266,1636,1792,1793,650,658,1294,415,637]);