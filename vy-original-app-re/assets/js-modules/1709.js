__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.navigateToScreen=function(t){return n.NavigationActions.navigate({routeName:T,params:t})},e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=b();if(n&&n.has(t))return n.get(t);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var l=o?Object.getOwnPropertyDescriptor(t,u):null;l&&(l.get||l.set)?Object.defineProperty(s,u,l):s[u]=t[u]}s.default=t,n&&n.set(t,s);return s})(r(d[0])),n=r(d[1]),s=r(d[2]),o=r(d[3]),u=r(d[4]),l=r(d[5]),c=r(d[6]),p=r(d[7]),f=r(d[8]),v=_(r(d[9])),h=_(r(d[10])),y=_(r(d[11])),S=_(r(d[12]));function _(t){return t&&t.__esModule?t:{default:t}}function b(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return b=function(){return t},t}function O(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function P(t,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&k(t,n)}function k(t,n){return(k=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var T='VippsPaymentScreen';var R=(function(n){function h(t){var n,s,o;return O(this,h),s=this,(n=!(o=I(h).call(this,t))||"object"!=typeof o&&"function"!=typeof o?w(s):o).state={status:{type:'LOADING'},url:void 0},n.handleSetStatus=n.handleSetStatus.bind(w(n)),n.handleBackPress=n.handleBackPress.bind(w(n)),n.navigateToReceipt=n.navigateToReceipt.bind(w(n)),n}var y,_,b;return E(h,t.Component),y=h,(_=[{key:"componentDidMount",value:function(){this.preparePaymentWithVipps()}},{key:"preparePaymentWithVipps",value:function(){var t,n,s,o;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,this.handleSetStatus({type:'LOADING'}),u.next=4,regeneratorRuntime.awrap((0,l.canOpenVipps)());case 4:return u.sent||((0,l.showInstallAppAlert)(),this.props.navigation.goBack(null)),t=this.props.navigation.state.params.order,u.next=9,regeneratorRuntime.awrap((0,p.initiatePaymentWithVipps)(t.id,t.user));case 9:n=u.sent,s=n.url,this.setState({url:s,status:{type:'INITIATED'}}),u.next=18;break;case 14:u.prev=14,u.t0=u.catch(0),o=(0,f.getMessageFromErrorIfPresent)(u.t0)||(0,S.default)('vipps_rejected_error_message'),this.handleSetStatus({type:'ERROR',message:o});case 18:case"end":return u.stop()}},null,this,[[0,14]])}},{key:"navigateToReceipt",value:function(){var t=this.props.navigation.state.params.receiptParams;this.props.navigation.dispatch((0,o.navigateToScreen)(t)),this.handleSetStatus({type:'FINISHED'})}},{key:"handleSetStatus",value:function(t){this.setState({status:t})}},{key:"handleBackPress",value:function(){var t=this;if('LOADING'===this.state.status.type||'INITIATED'===this.state.status.type){var n=this.props.navigation.state.params.order;s.Alert.alert((0,S.default)('cancel_vipps_warning_title'),(0,S.default)('cancel_vipps_warning_message'),[{text:(0,S.default)('cancel_vipps_no'),style:'default'},{text:(0,S.default)('cancel_vipps_yes'),onPress:function(){c.remoteLogger.info(c.sources.VIPPS,'User cancelled polling',{orderId:n.id}),t.props.navigation.goBack(null)},style:'cancel'}])}else this.props.navigation.goBack(null);this.handleSetStatus({type:'FINISHED'})}},{key:"render",value:function(){var n=this.props.navigation.state.params.order;return t.createElement(u.ScreenView,null,t.createElement(u.HeaderCard,null,t.createElement(v.default,{onBackPress:this.handleBackPress,headerText:(0,S.default)('vipps')})),t.createElement(s.View,{style:{flex:1}},t.createElement(j,{url:this.state.url,navigateToReceipt:this.navigateToReceipt,order:n,status:this.state.status,onSetStatus:this.handleSetStatus})))}}])&&P(y.prototype,_),b&&P(y,b),h})(),j=function(n){switch(n.status.type){case'INITIATED':return n.url?t.createElement(h.default,{navigateToReceipt:n.navigateToReceipt,vippsUrl:n.url,order:n.order,onSetStatus:n.onSetStatus}):t.createElement(y.default,null);case'LOADING':return t.createElement(y.default,null);case'ERROR':return t.createElement(u.MessageBox,{level:"error",message:n.status.message,style:{margin:18}});case'FINISHED':return null}},D=R;e.default=D},1709,[7,435,10,1705,653,1710,633,642,636,1715,1716,1718,1717]);