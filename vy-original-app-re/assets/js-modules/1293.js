__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.SCROLL_ANIMATION_DISTANCE=void 0;var t=O(r(d[0])),n=r(d[1]),s=r(d[2]),o=I(r(d[3])),l=I(r(d[4])),u=r(d[5]),c=r(d[6]),h=I(r(d[7])),f=r(d[8]),p=r(d[9]),v=I(r(d[10])),S=I(r(d[11])),b=O(r(d[12])),R=I(r(d[13])),T=I(r(d[14])),_=I(r(d[15])),E=r(d[16]),y=r(d[17]);function I(t){return t&&t.__esModule?t:{default:t}}function B(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return B=function(){return t},t}function O(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=B();if(n&&n.has(t))return n.get(t);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var u=o?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(s,l,u):s[l]=t[l]}return s.default=t,n&&n.set(t,s),s}function L(t,n){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,o)}return s}function F(t){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?L(Object(s),!0).forEach(function(n){A(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):L(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function A(t,n,s){return n in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t}function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function k(t,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function D(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&H(t,n)}function H(t,n){return(H=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var N=90;e.SCROLL_ANIMATION_DISTANCE=N;var C=(function(s){function I(s){var o,l,u;w(this,I),l=this,u=x(I).call(this,s),o=!u||"object"!=typeof u&&"function"!=typeof u?P(l):u;var c=s.navigation.state.params,f=c.from,p=c.to,v=(0,E.isBusStations)(f,p)?'BUS':'TRAIN';return o.state={selectedTab:v,passengers:[],passengerCategories:[],availableExtras:[],isBusDeparturesVisited:!0,train:{isFetching:!1,isRefreshing:!1,isFetchingLater:!1,failedFetchingLater:!1,itineraries:void 0},bus:{isFetching:!1,isRefreshing:!1,isFetchingLater:!1,failedFetchingLater:!1,itineraries:void 0}},o._currentListRef=t.default.createRef(),o._isScrolling=!1,o._clampedScrollValue=0,o._scrollValueY=0,o._offsetValueY=0,o._currentListScrollY=new n.Animated.Value(0),o._currentListScrollY.addListener(function(t){var n=t.value,s=n-o._scrollValueY;o._scrollValueY=n,o._clampedScrollValue=Math.min(Math.max(o._clampedScrollValue+s,0),N)}),o._currentOffsetAnimationY=new n.Animated.Value(0),o._currentOffsetAnimationY.addListener(function(t){var n=t.value;o._offsetValueY=n}),o.clampedScroll=n.Animated.diffClamp(n.Animated.add(o._currentListScrollY.interpolate({inputRange:[N,91],outputRange:[0,1],extrapolateLeft:'clamp'}),o._currentOffsetAnimationY),0,N),o.handleChangeSelectedTab=o.handleChangeSelectedTab.bind(P(o)),o.fetchTrainItineraries=o.fetchTrainItineraries.bind(P(o)),o.fetchBusItineraries=o.fetchBusItineraries.bind(P(o)),o.handleSelectPassengers=o.handleSelectPassengers.bind(P(o)),o.handleTrainEndReached=o.handleTrainEndReached.bind(P(o)),o.handleTrainRefresh=o.handleTrainRefresh.bind(P(o)),o.handleBusEndReached=o.handleBusEndReached.bind(P(o)),o.handleBusRefresh=o.handleBusRefresh.bind(P(o)),o.handleExpandHeader=o.handleExpandHeader.bind(P(o)),o.handleScrollBeginDrag=o.handleScrollBeginDrag.bind(P(o)),o.handleScrollEndDrag=o.handleScrollEndDrag.bind(P(o)),o.handleMomentumScrollBegin=o.handleMomentumScrollBegin.bind(P(o)),o.handleMomentumScrollEnd=(0,h.default)(o.handleMomentumScrollEnd.bind(P(o)),125,!1),o.shouldViewHeaderToggleBar=o.shouldViewHeaderToggleBar.bind(P(o)),o}var B,O,L;return D(I,t.Component),B=I,(O=[{key:"componentDidMount",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap((0,c.shouldShowOnboarding)(c.SHOW_ONBOARDING_DEPARTURES_BUS_KEY));case 2:t=n.sent,this.setState({isBusDeparturesVisited:!t});case 4:case"end":return n.stop()}},null,this)}},{key:"componentDidUpdate",value:function(t){t.preferredPassengerCategory!==this.props.preferredPassengerCategory&&this.handleSelectPassengers([this.props.preferredPassengerCategory],!0)}},{key:"componentWillUnmount",value:function(){this._currentListScrollY.removeAllListeners(),this._currentOffsetAnimationY.removeAllListeners()}},{key:"fetchTrainItineraries",value:function(){var t,n,s;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:t=this.props.navigation.state.params,n=t.from,s=t.to,(0,E.isTrainStations)(n,s)?this.fetchAndSetItinerariesForTrainJourney():this.setState(function(t){return F({},t,{train:F({},t.train,{itineraries:void 0,isFetching:!1,isRefreshing:!1})})});case 3:case"end":return o.stop()}},null,this)}},{key:"fetchAndSetItinerariesForTrainJourney",value:function(){var t,n,s,o,l,c,h;return regeneratorRuntime.async(function(f){for(;;)switch(f.prev=f.next){case 0:return t=this.props.navigation.state.params,n=t.from,s=t.to,o=t.selectedTime,l=this.state.passengers,c=o.format(p.SERVER_DATE_FORMAT),this.setState(function(t){return{train:F({},t.train,{isFetching:!0})}}),f.prev=4,f.next=7,regeneratorRuntime.awrap((0,u.fetchItinerariesForStationPair)(n.name,s.name,c,l));case 7:h=f.sent,this.setInitialTrainItineraries(h),f.next=15;break;case 11:f.prev=11,f.t0=f.catch(4),this.setState(function(t){return{train:F({},t.train,{isFetching:!1,isRefreshing:!1})}}),Y();case 15:case"end":return f.stop()}},null,this,[[4,11]])}},{key:"fetchLaterTrainItineraries",value:function(){var t,n,s,o,c,h,f,p;return regeneratorRuntime.async(function(v){for(;;)switch(v.prev=v.next){case 0:if(t=this.state.train,n=t.itineraries,s=t.isFetchingLater,!n||s){v.next=16;break}return this.setState(function(t){return{train:F({},t.train,{isFetchingLater:!0})}}),v.prev=3,v.next=6,regeneratorRuntime.awrap((0,u.fetchLaterItineraries)(n.resultSetId));case 6:o=v.sent,c=n.itineraries.concat(o.itineraries),this.setState(function(t){var n=t.train.itineraries?F({},t.train.itineraries,{itineraries:c}):void 0;return{train:F({},t.train,{isFetchingLater:!1,itineraries:n})}}),h=this.props.navigation.state.params,f=h.from,p=h.to,l.default.FETCH_MORE_ITINERARIES({from:f.name,to:p.name,departuresCount:c.length}),v.next=16;break;case 13:v.prev=13,v.t0=v.catch(3),this.setState(function(t){return{train:F({},t.train,{isFetchingLater:!1,failedFetchingLater:!0})}});case 16:case"end":return v.stop()}},null,this,[[3,13]])}},{key:"fetchBusItineraries",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap(this.getBusItinerariesAndPossiblyUpdatePassengerCategories());case 3:t=n.sent,this.setInitialBusItineraries(t),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),this.setState(function(t){return{bus:F({},t.bus,{isFetching:!1,isRefreshing:!1})}}),Y();case 11:case"end":return n.stop()}},null,this,[[0,7]])}},{key:"getBusItinerariesAndPossiblyUpdatePassengerCategories",value:function(){var t,n,s,o,l,c,h;return regeneratorRuntime.async(function(f){for(;;)switch(f.prev=f.next){case 0:if(t=this.props.navigation.state.params,n=t.from,s=t.to,o=t.selectedTime,l=this.state.passengers,c=o.format(p.SERVER_DATE_FORMAT),!(0,E.isBusStations)(n,s)){f.next=11;break}return f.next=6,regeneratorRuntime.awrap((0,u.fetchBusItineraries)(n.id,s.id,c,l));case 6:return h=f.sent,this.setState({passengerCategories:h.passengerInformation.availableCategories}),f.abrupt("return",h);case 11:return f.next=13,regeneratorRuntime.awrap((0,u.fetchBusItinerariesWithTrainRelation)(n.name,s.name,c,l));case 13:return f.abrupt("return",f.sent);case 14:case"end":return f.stop()}},null,this)}},{key:"getLaterBusItineraries",value:function(){var t,n,s,u,c,h,f,v,S,b,R;return regeneratorRuntime.async(function(T){for(;;)switch(T.prev=T.next){case 0:if(t=this.state.bus,n=t.itineraries,s=t.isFetchingLater,u=this.props.navigation.state.params,c=u.from,h=u.to,!n||s){T.next=25;break}if(this.setState(function(t){return{bus:F({},t.bus,{isFetchingLater:!0})}}),T.prev=4,(f=n.nettbussItineraries).length){T.next=8;break}return T.abrupt("return");case 8:return v=(0,o.default)(f[f.length-1].plannedDeparture).add(1,'days').format(p.SERVER_DATE_FORMAT),T.next=11,regeneratorRuntime.awrap(this.fetchLaterBusItineraries(v));case 11:if(0!==(S=T.sent).nettbussItineraries.length){T.next=15;break}return this.setFailedStateForFetchingLaterToAvoidInfiniteLoop(),T.abrupt("return");case 15:b=f.concat(S.nettbussItineraries),R=F({},n,{nettbussItineraries:b}),this.setState(function(t){return{bus:F({},t.bus,{isFetchingLater:!1,failedFetchingLater:!1,itineraries:R})}}),l.default.FETCH_LATER_BUS({fromStation:c.name,toStation:h.name,departureCount:b.length}),T.next=25;break;case 21:T.prev=21,T.t0=T.catch(4),this.setState(function(t){return{bus:F({},t.bus,{isFetchingLater:!1,failedFetchingLater:!0})}}),Y();case 25:case"end":return T.stop()}},null,this,[[4,21]])}},{key:"fetchLaterBusItineraries",value:function(t){var n,s,o;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:if(n=this.props.navigation.state.params,s=n.from,o=n.to,!(0,E.isBusStations)(s,o)){l.next=7;break}return l.next=4,regeneratorRuntime.awrap((0,u.fetchBusItineraries)(s.id,o.id,t,this.state.passengers));case 4:return l.abrupt("return",l.sent);case 7:return l.next=9,regeneratorRuntime.awrap((0,u.fetchBusItinerariesWithTrainRelation)(s.name,o.name,t,this.state.passengers));case 9:return l.abrupt("return",l.sent);case 10:case"end":return l.stop()}},null,this)}},{key:"setFailedStateForFetchingLaterToAvoidInfiniteLoop",value:function(){this.setState(function(t){return{bus:F({},t.bus,{isFetchingLater:!1,failedFetchingLater:!0})}})}},{key:"setInitialTrainItineraries",value:function(t){var n=t.passengerInformation,s=n.passengers,o=n.availableCategories,l=n.availableExtras,u=n.modified,c=n.modificationReason;if(u){var h=this.props.navigation.state.params,f=h.from,p=h.to;j(f.name,p.name,'TRAIN',c)}this.setState(function(n){return F({},n,{},u?M('BUS',n.bus):{},{availableExtras:l,passengers:s,passengerCategories:o,train:F({},n.train,{itineraries:t,isFetching:!1,isRefreshing:!1})})})}},{key:"setInitialBusItineraries",value:function(t){var n=t.passengerInformation,s=n.passengers,o=n.modified,l=n.modificationReason,u=n.availableExtras;if(o){var c=this.props.navigation.state.params,h=c.from,f=c.to;j(h.name,f.name,'BUS',l)}this.setState(function(n){var l=s.length>0?s:n.passengers;return F({},n,{},o?M('TRAIN',n.train):{},{passengers:l,availableExtras:u,bus:F({},n.bus,{itineraries:t,isFetching:!1,isRefreshing:!1})})})}},{key:"handleSelectPassengers",value:function(t){var n=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setState(function(n){var o=n.selectedTab,l='TRAIN'===o?'train':'bus';return F({},n,{},M('TRAIN'===o?'BUS':'TRAIN',n['TRAIN'===o?'bus':'train']),A({passengers:t},l,F({},n[l],{isFetching:s})))},function(){s&&('BUS'===n.state.selectedTab?n.fetchBusItineraries():n.fetchTrainItineraries())})}},{key:"handleChangeSelectedTab",value:function(){var t=this;this.setState(function(n){var s='TRAIN'===n.selectedTab?'BUS':'TRAIN',o=n.bus.itineraries,u=n.train.itineraries,c=!!o&&o.nettbussItineraries.length>0,h=!!u&&u.itineraries.length>0;if('BUS'===s){var f=t.props.navigation.state.params,p=f.from,v=f.to;l.default.BUS_TAB_TOGGLE_PRESSED({fromStation:p.name,toStation:v.name})}return F({},n,{selectedTab:s,bus:F({},n.bus,{isFetching:'BUS'===s&&!c}),train:F({},n.train,{isFetching:'TRAIN'===s&&!h})})},function(){var n=t.state,s=n.bus.isFetching,o=n.train.isFetching;s&&t.fetchBusItineraries(),o&&t.fetchTrainItineraries()})}},{key:"handleTrainEndReached",value:function(t){var n=t.distanceFromEnd;if(V(n)){var s=this.state.train,o=s.failedFetchingLater,l=s.itineraries;void 0!==l&&l&&!o&&this.fetchLaterTrainItineraries()}}},{key:"handleTrainRefresh",value:function(){this.setState(function(t){return{train:F({},t.train,{isRefreshing:!0,failedFetchingLater:!1})}},this.fetchTrainItineraries)}},{key:"handleBusEndReached",value:function(t){var n=t.distanceFromEnd;V(n)&&(this.state.bus.failedFetchingLater||this.getLaterBusItineraries())}},{key:"handleBusRefresh",value:function(){this.setState(function(t){return{bus:F({},t.bus,{isRefreshing:!0})}},this.fetchBusItineraries)}},{key:"handleExpandHeader",value:function(){this._isScrolling||n.Animated.timing(this._currentOffsetAnimationY,{toValue:this._offsetValueY-N,duration:250,useNativeDriver:!0}).start()}},{key:"handleScrollBeginDrag",value:function(){this._isScrolling=!0}},{key:"handleScrollEndDrag",value:function(){this._scrollEndTimer=setTimeout(this.handleMomentumScrollEnd,125)}},{key:"handleMomentumScrollBegin",value:function(){clearTimeout(this._scrollEndTimer)}},{key:"handleMomentumScrollEnd",value:function(){var t=this,s=this._scrollValueY>N&&this._clampedScrollValue>45?this._offsetValueY+N:this._offsetValueY-N;n.Animated.timing(this._currentOffsetAnimationY,{toValue:s,duration:250,useNativeDriver:!0}).start(function(){return t._isScrolling=!1})}},{key:"shouldViewHeaderToggleBar",value:function(){var t=this.props.navigation.state.params.busDeparturesAvailable;return!!this.checkIfTrainStations()&&t}},{key:"checkIfTrainStations",value:function(){var t=this.props.navigation.state.params,n=t.from,s=t.to;return(0,E.isTrainStations)(n,s)}},{key:"calculateHeightOfHeader",value:function(){var t=this.props.navigation.state.params,n=t.from,s=t.to;return("from + "+n.name+" + to "+s.name).length>37?(0,y.isNotchPhone)()?123:100:(0,y.isNotchPhone)()?100:80}},{key:"render",value:function(){var s=this,o=this.props,u=o.isLoggedIn,c=o.customerNumber,h=o.employeeTicketRights,p=this.state,E=p.train,I=E.isFetching,B=E.isFetchingLater,O=E.failedFetchingLater,L=E.isRefreshing,F=p.bus,A=F.isFetching,w=F.isFetchingLater,k=F.isRefreshing,x=p.passengers,P=p.passengerCategories,D=p.availableExtras,H=p.selectedTab,C='TRAIN'===H,V=!C,M=I||B||A||w,Y=(0,f.getPassengerSelectionSummary)(x,P),j=this.clampedScroll.interpolate({inputRange:[0,N],outputRange:((0,y.isNotchPhone)(),[0,-b.HEIGHT_OF_PASSENGER_SELECTION-18]),extrapolate:'clamp'}),U=this.clampedScroll.interpolate({inputRange:[0,N],outputRange:[0,-18],extrapolate:'clamp'}),G={marginBottom:this.shouldViewHeaderToggleBar()?-b.HEIGHT_OF_TOGGLE_BAR:0,marginTop:this.shouldViewHeaderToggleBar()?b.HEIGHT_WITH_TOGGLE_BAR+this.calculateHeightOfHeader():b.HEIGHT_WITHOUT_TOGGLE_BAR+this.calculateHeightOfHeader(),transform:this.shouldViewHeaderToggleBar()?[{translateY:j}]:[{translateY:U}]},W=this.state.bus.itineraries,J=this.state.train.itineraries;return t.default.createElement(n.View,{style:{flex:1}},t.default.createElement(n.Animated.View,{style:G},C&&t.default.createElement(v.default,{listRef:this._currentListRef,listScrollY:this._currentListScrollY,onScrollBeginDrag:this.handleScrollBeginDrag,onScrollEndDrag:this.handleScrollEndDrag,onMomentumScrollBegin:this.handleMomentumScrollBegin,onMomentumScrollEnd:this.handleMomentumScrollEnd,isLoggedIn:u,passengers:x,itineraries:J||{},isRefreshing:L,isFetching:I,isFetchingLater:B,hasFailedFetchingLater:O,onRefresh:this.handleTrainRefresh,onEndReached:this.handleTrainEndReached}),V&&t.default.createElement(S.default,{listRef:this._currentListRef,listScrollY:this._currentListScrollY,onScrollBeginDrag:this.handleScrollBeginDrag,onScrollEndDrag:this.handleScrollEndDrag,onMomentumScrollBegin:this.handleMomentumScrollBegin,onMomentumScrollEnd:this.handleMomentumScrollEnd,isFetching:A,isFetchingLater:w,isRefreshing:k,itineraries:W||{},onRefresh:this.handleBusRefresh,onEndReached:this.handleBusEndReached,passengerSummary:Y,busInTrainSearch:this.shouldViewHeaderToggleBar})),t.default.createElement(b.default,{animationRange:this.clampedScroll,onExpandHeader:function(){l.default.BUS_DEPARTURES_TRIANGLE_HEADER_EXPANDED(),s.handleExpandHeader()},onBackButtonPressed:this.props.onBackButtonPressed,travelMethodString:(0,_.default)(V?'bus':'train'),passengerSummary:Y,from:this.props.navigation.state.params.from.name,to:this.props.navigation.state.params.to.name,toggleBar:this.shouldViewHeaderToggleBar()?t.default.createElement(T.default,{animationRange:this.clampedScroll,disabled:M,selectedTab:H,onChangeSelectedTab:this.handleChangeSelectedTab,itinerariesBus:W?W.nettbussItineraries:void 0,itinerariesTrain:J?J.itineraries:void 0}):null},t.default.createElement(R.default,{modality:H,passengers:x,passengerCategories:P,availableExtras:D,isFetching:I||A,customerCardNumber:c,onSelectPassengers:this.handleSelectPassengers,employeeTicketRights:h,passengerSummary:Y})))}}])&&k(B.prototype,O),L&&k(B,L),I})(),V=function(t){return t>-250};function M(t,n){return A({},t.toLowerCase(),F({},n,{itineraries:void 0}))}function Y(){n.Alert.alert((0,_.default)('itinerary_retrieval_alert_title'),(0,_.default)('itinerary_retrieval_alert_message'),[{text:'Ok'}])}function j(t,s,o,u){n.Alert.alert((0,_.default)('categories_modified_alert_title'),u||(0,_.default)('categories_modified_alert_default_message')),l.default.PASSENGER_CATEGORY_MODIFIED({fromStation:t,toStation:s,reason:u||'Unknown reason'})}var U=(0,s.withNavigation)(C);e.default=U},1293,[7,10,435,628,1294,642,1295,983,1296,414,1297,1304,1312,1313,1330,1234,1331,968]);