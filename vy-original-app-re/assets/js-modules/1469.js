__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=T(r(d[0])),n=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=k();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var u=s?Object.getOwnPropertyDescriptor(t,c):null;u&&(u.get||u.set)?Object.defineProperty(o,c,u):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[1])),o=T(r(d[2])),s=r(d[3]),c=r(d[4]),u=r(d[5]),l=r(d[6]),f=r(d[7]),p=r(d[8]),h=r(d[9]),v=T(r(d[10])),y=T(r(d[11])),C=T(r(d[12])),b=T(r(d[13])),P=T(r(d[14])),S=T(r(d[15])),I=T(r(d[16])),w=r(d[17]),O=r(d[18]),R=T(r(d[19]));function k(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return k=function(){return t},t}function T(t){return t&&t.__esModule?t:{default:t}}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _(t,n){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var o=[],s=!0,c=!1,u=void 0;try{for(var l,f=t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();!(s=(l=f.next()).done)&&(o.push(l.value),!n||o.length!==n);s=!0);}catch(t){c=!0,u=t}finally{try{s||null==f.return||f.return()}finally{if(c)throw u}}return o}}function D(t){if(Array.isArray(t))return t}function j(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function x(t){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function A(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}function M(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function V(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function L(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&B(t,n)}function B(t,n){return(B=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var G=(function(f){function k(t){var n,o,s;M(this,k),o=this,n=!(s=N(k).call(this,t))||"object"!=typeof s&&"function"!=typeof s?F(o):s;var c=t.navigation.state.params.periodTicketOptions,u=c.products,l=c.passengerInformation,f=u.reduce(function(t,n){return 0===t.filter(function(t){return t.duration===n.durationDetails.duration}).length&&t.push(n.durationDetails),t},[]);return n.state={selectedPeriodTicket:u[0],isChoosePassengerCategoryVisible:!1,selectedConnections:[],passenger:l.availableCategories[0],products:u,durations:f,durationDetail:f[0],isCreatingOrder:!1,passengerInformation:l,seatReservationInfoModalVisible:!1,seatReservationInformationFetch:{loading:!0}},n.changePassenger=n.changePassenger.bind(F(n)),n.selectDuration=n.selectDuration.bind(F(n)),n.onProductPressed=n.onProductPressed.bind(F(n)),n.toggleChoosePassengerCategoryModal=n.toggleChoosePassengerCategoryModal.bind(F(n)),n.onConnectionPressed=n.onConnectionPressed.bind(F(n)),n.navigateToOrderConfirmation=n.navigateToOrderConfirmation.bind(F(n)),n.showSeatReservationInfo=n.showSeatReservationInfo.bind(F(n)),n.closeSeatReservationInfo=n.closeSeatReservationInfo.bind(F(n)),n.getAndShowSeatReservationInfoIfNeeded=n.getAndShowSeatReservationInfoIfNeeded.bind(F(n)),n}var T,E,_;return L(k,n.Component),T=k,(E=[{key:"componentDidMount",value:function(){this.getAndShowSeatReservationInfoIfNeeded(this.state.products)}},{key:"getAndShowSeatReservationInfoIfNeeded",value:function(t){var n,s;return regeneratorRuntime.async(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,regeneratorRuntime.awrap((0,w.getSeatReservationSeasonTicketInfo)());case 3:return n=c.sent,this.setState({seatReservationInformationFetch:{success:!0,value:n}}),c.t0=JSON,c.next=8,regeneratorRuntime.awrap(o.default.getItem("@SeatReservationInfo:key"));case 8:c.t1=c.sent,s=c.t0.parse.call(c.t0,c.t1),t.some(function(t){return t.description.toLowerCase().includes('setereservasjon')||t.description.toLowerCase().includes('seat reservation')})&&null===s&&this.showSeatReservationInfo(),c.next=17;break;case 14:c.prev=14,c.t2=c.catch(0),this.setState({seatReservationInformationFetch:{error:!0,message:c.t2}});case 17:case"end":return c.stop()}},null,this,[[0,14]])}},{key:"showSeatReservationInfo",value:function(){this.setState({seatReservationInfoModalVisible:!0})}},{key:"closeSeatReservationInfo",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this.setState({seatReservationInfoModalVisible:!1}));case 2:return t.next=4,regeneratorRuntime.awrap(o.default.setItem("@SeatReservationInfo:key",JSON.stringify(!0)));case 4:case"end":return t.stop()}},null,this)}},{key:"changePassenger",value:function(t){var n=this.state.passengerInformation.availableCategories.filter(function(n){return n.type===t.type})[0],o=this.state.products.filter(function(t){return t.passengerType===n.type});this.setState(function(s){return{isChoosePassengerCategoryVisible:!1,passenger:n,durationDetail:o[0].durationDetails,selectedPeriodTicket:o[0],selectedConnections:t===s.passenger?s.selectedConnections:[]}})}},{key:"onProductPressed",value:function(t){this.setState({selectedPeriodTicket:t,selectedConnections:[]})}},{key:"onConnectionPressed",value:function(t){this.state.selectedConnections.filter(function(n){return n.id===t.id}).length>0?this.setState(function(n){return{selectedConnections:n.selectedConnections.filter(function(n){return n.id!==t.id})}}):this.setState(function(n){return{selectedConnections:[].concat((o=n.selectedConnections,A(o)||x(o)||j()),[t])};var o})}},{key:"toggleChoosePassengerCategoryModal",value:function(){t.default.OPEN_PASSENGER_CATEGORIES_RUTER(),this.setState(function(t){return{isChoosePassengerCategoryVisible:!t.isChoosePassengerCategoryVisible}})}},{key:"selectDuration",value:function(t){this.setState(function(n){return{durationDetail:t,selectedConnections:[],selectedPeriodTicket:n.products.filter(function(n){return n.durationDetails.duration===t.duration}).filter(function(t){return t.passengerType===n.passenger.type})[0]||n.selectedPeriodTicket}})}},{key:"navigateToOrderConfirmation",value:function(){var n,o,c,u,f,h,v,y,C,b,P,S,w,R;return regeneratorRuntime.async(function(k){for(;;)switch(k.prev=k.next){case 0:return n=this.props.navigation.state.params.selectedTime,o=this.state,c=o.selectedPeriodTicket,u=o.selectedConnections,k.prev=2,this.setState({isCreatingOrder:!0}),h=W(c,u),k.next=7,regeneratorRuntime.awrap((0,l.periodTicketOrderFromProductId)(h,n));case 7:return v=k.sent,y=v.id,k.next=11,regeneratorRuntime.awrap((0,l.getOrder)(y));case 11:return C=k.sent,b=this.props.navigation.state.params,P=b.from,S=b.to,k.next=15,regeneratorRuntime.awrap(O.UserAuthentication.isLoggedIn());case 15:w=k.sent,R=!1===w?'PeriodTicketLoginScreen':'PeriodTicketOrderConfirmation',this.props.navigation.navigate(R,{orderId:y,order:C,operator:this.state.selectedPeriodTicket.operator,from:P.name,to:S.name,previousStack:{routeName:this.props.navigation.state.routeName,key:this.props.navigation.state.key,firstRouteName:'StationChooserScreen'}}),t.default.NAVIGATE_PERIOD_TICKET_PAYMENT({selectedConnections:null!=(f=this.state.selectedConnections.length)?f:0}),k.next=24;break;case 21:k.prev=21,k.t0=k.catch(2),s.Alert.alert((0,I.default)('order_or_payment_failed_alert_title'),(0,p.getMessageFromErrorIfPresent)(k.t0)||(0,I.default)('initiate_order_failed_generic_message'));case 24:return k.prev=24,this.setState({isCreatingOrder:!1}),k.finish(24);case 27:case"end":return k.stop()}},null,this,[[2,21,24,27]])}},{key:"render",value:function(){var t=this,o=this.props.navigation.state.params,l=o.from,f=o.to,p=o.periodTicketOptions,w=this.state,O=w.isCreatingOrder,k=w.selectedPeriodTicket,T=w.selectedConnections,E=w.passenger,_=J(this.state.selectedPeriodTicket,this.state.selectedConnections),D=p.products.filter(function(n){return n.passengerType===t.state.passenger.type}).filter(function(n){var o;return n.durationDetails.duration===(null==(o=t.state.durationDetail)?void 0:o.duration)}),j=p.products.reduce(function(n,o){return 0===n.filter(function(t){return t.duration===o.durationDetails.duration}).length&&o.passengerType===t.state.passenger.type&&n.push(o.durationDetails),n},[]),x=this.state.seatReservationInformationFetch.success?this.state.seatReservationInformationFetch.value.header:'',A=this.state.seatReservationInformationFetch.success?this.state.seatReservationInformationFetch.value.text:'';return n.createElement(u.ScreenView,{style:{backgroundColor:h.colors.brightGrey}},n.createElement(R.default,{isVisible:this.state.seatReservationInfoModalVisible,onRequestClose:this.closeSeatReservationInfo},n.createElement(P.default,{header:x,text:A,onClose:this.closeSeatReservationInfo})),n.createElement(y.default,{from:l.name,to:f.name,operator:this.state.selectedPeriodTicket.operator}),n.createElement(s.ScrollView,{contentContainerStyle:{margin:24,marginTop:18,paddingBottom:100}},n.createElement(S.default,{passenger:this.state.passenger,onToggleModal:this.toggleChoosePassengerCategoryModal}),n.createElement(u.LightBlueLine,{style:{marginVertical:12}}),n.createElement(C.default,{id:"duration",type:"Duration",items:j,extraData:this.state.durationDetail,onItemPressed:function(n){return t.selectDuration(n)}}),D.length>1&&n.createElement(C.default,{id:"productId",type:"Product",items:D,extraData:k,onItemPressed:function(n){return t.onProductPressed(n)}}),k&&k.availableConnections&&n.createElement(s.View,null,n.createElement(u.LightBlueLine,{style:{marginVertical:18}}),n.createElement(b.default,{selectedConnections:T,selectedPeriodTicket:k,handleConnectionPressed:function(n){return t.onConnectionPressed(n)}}))),n.createElement(s.View,{style:{marginHorizontal:18,marginBottom:18}},n.createElement(u.LightBlueLine,{style:{marginBottom:12}}),n.createElement(s.View,{style:{flexDirection:'row',justifyContent:'space-between',marginBottom:12}},n.createElement(c.MediumText,null,(0,I.default)('price')),n.createElement(c.MediumTextBold,null,_)),n.createElement(u.PrimaryButton,{loading:O,onPress:this.navigateToOrderConfirmation,disabled:O,containerStyle:{marginVertical:18}},(0,I.default)('go_to_payment'))),n.createElement(v.default,{key:null==E?void 0:E.type,passenger:E,passengerCategories:p.passengerInformation.availableCategories,changePassenger:this.changePassenger,isVisible:this.state.isChoosePassengerCategoryVisible,onClose:this.toggleChoosePassengerCategoryModal}))}}])&&V(T.prototype,E),_&&V(T,_),k})();G.navigationOptions={title:(0,I.default)('period_ticket')};var J=function(t,n){var o=U(t,n,'totalPrice');return(0,f.getAmountFromOereWithCurrency)(o)},W=function(t,n){return U(t,n,'productId')},U=function(t,n,o){var s,c,u=t.availableConnections&&t.availableConnections.groups.map(function(t){return null==t?void 0:t.connectionIds})||[],l=(c=1,D(s=u)||_(s,c)||E())[0];l&&l.sort(q());var f,p=n.map(function(t){return t.id}).sort(q());return JSON.stringify(l)===JSON.stringify(p)?null==(f=t.availableConnections)?void 0:f.groups[0][o]:t.availableConnections&&t.availableConnections.groups&&n.length>0?n.map(function(t){return t[o]})[0]:t[o]},q=function(t,n){return function(t,n){return t>n?-1:1}},z=G;e.default=z},1469,[1294,7,613,10,962,653,642,1236,636,414,1470,1473,1474,1477,1478,1479,1234,1480,632,1271]);