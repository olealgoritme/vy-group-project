__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=S();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var c=s?Object.getOwnPropertyDescriptor(t,u):null;c&&(c.get||c.set)?Object.defineProperty(o,u,c):o[u]=t[u]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=b(r(d[2])),s=r(d[3]),u=r(d[4]),c=r(d[5]),l=r(d[6]),p=r(d[7]),f=b(r(d[8])),P=b(r(d[9])),h=b(r(d[10])),y=b(r(d[11])),v=b(r(d[12]));function b(t){return t&&t.__esModule?t:{default:t}}function S(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return S=function(){return t},t}function O(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function C(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&E(t,n)}function E(t,n){return(E=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var k={container:{marginTop:18,flexDirection:'row',justifyContent:'space-between',alignItems:'center',marginBottom:12}},j=(function(b){function S(t){var n,o,s;return O(this,S),o=this,(n=!(s=T(S).call(this,t))||"object"!=typeof s&&"function"!=typeof s?w(o):s).state={isLoadingProducts:!1,currentProduct:void 0,filteredProducts:[],products:[],passenger:void 0,passengerCategories:[],productMessages:[]},n.changeCurrentProduct=n.changeCurrentProduct.bind(w(n)),n.changePassenger=n.changePassenger.bind(w(n)),n.filterProducts=n.filterProducts.bind(w(n)),n.handleContinueToPaymentPress=n.handleContinueToPaymentPress.bind(w(n)),n.orderToSave=n.orderToSave.bind(w(n)),n}var E,j,x;return _(S,t.Component),E=S,(j=[{key:"componentDidUpdate",value:function(t,n){var o=this.props,s=o.fromStop,u=o.toStop;s&&u&&(t.fromStop!==s||t.toStop!==u)&&this.getProducts()}},{key:"getProducts",value:function(){var t,n,o,s,u,l,f,P,h,y=this;return regeneratorRuntime.async(function(b){for(;;)switch(b.prev=b.next){case 0:if(t=this.props,n=t.operator,o=t.fromStop,s=t.toStop,o&&s){b.next=3;break}return b.abrupt("return");case 3:return this.setState({isLoadingProducts:!0,currentProduct:void 0}),b.prev=4,u=new Date,b.next=8,regeneratorRuntime.awrap((0,c.fetchLocalOperatorPeriodTicketProducts)(o.id,s.id,n));case 8:l=b.sent,f=new Date-u,P=f<=750?750-f:0,this.setProducts(l),setTimeout(function(){return y.setState({isLoadingProducts:!1})},P),b.next=19;break;case 15:b.prev=15,b.t0=b.catch(4),h=(0,p.getMessageFromErrorIfPresent)(b.t0)||(0,v.default)('no_products_found'),this.setState({isLoadingProducts:!1,productMessages:[{text:h,type:'ERROR'}]});case 19:case"end":return b.stop()}},null,this,[[4,15]])}},{key:"setProducts",value:function(t){var n={type:t.passengerInformation.availableCategories[0].type,extras:[],discount:null,customerNumber:null};this.setState({passenger:n,currentProduct:t.products[0],products:t.products,passengerCategories:t.passengerInformation.availableCategories,productMessages:t.messages},this.filterProducts)}},{key:"changeCurrentProduct",value:function(t){this.setState({currentProduct:t})}},{key:"changePassenger",value:function(t){this.setState({passenger:t},this.filterProducts)}},{key:"filterProducts",value:function(){var t=this.state,n=t.currentProduct,o=t.passenger,s=t.products,u=o?s.filter(function(t){return t.passengerType===(null==o?void 0:o.type)}):s;this.setState({filteredProducts:u}),u.length&&!u.some(function(t){return t.id===(null==n?void 0:n.id)})&&this.changeCurrentProduct(u[0])}},{key:"orderToSave",value:function(t){var n=this.props,o=n.operator,s=n.fromStop,c=n.toStop,l=this.state,p=l.passenger,f=l.passengerCategories;if(s&&c&&t&&p)return{operator:o,ticketType:'PERIOD_TICKET',from:s,to:c,passengers:[p],passengerString:(0,u.getPassengerSelectionSummary)([p],f),duration:t.duration,viaZone:t.zoneData.viaZone,periodString:t.description}}},{key:"handleContinueToPaymentPress",value:function(){o.default.RUTER_CONTINUE_TO_PAYMENT({from:'Period Ticket',operator:this.props.operator}),this.props.navigateToOrderConfirmation(this.state.currentProduct,this.orderToSave(this.state.currentProduct))}},{key:"render",value:function(){var o,u,c=this.state,p=c.currentProduct,b=c.isLoadingProducts,S=c.filteredProducts,O=c.passenger,C=c.passengerCategories,T=c.productMessages,w=this.props,_=w.isCreatingOrder,E=w.operator,j=w.fromStop,x=w.toStop,D=w.changeStop,I=w.flipDirection,M=(0,l.getAmountFromOereWithCurrency)(null==p?void 0:null==(o=p.priceOptions[0])?void 0:o.amountInOere);return t.createElement(n.View,{style:{flex:1}},t.createElement(n.ScrollView,{keyboardShouldPersistTaps:"always",contentContainerStyle:{paddingBottom:100}},t.createElement(h.default,{messages:T}),t.createElement(y.default,{useCurrentPosition:!0,toStop:x,fromStop:j,changeStop:D,flipDirection:I,operator:E}),t.createElement(n.View,{style:{marginHorizontal:24}},O&&(null==C?void 0:C.length)>0&&t.createElement(f.default,{passenger:O,passengerCategories:C,changePassenger:this.changePassenger}),!b&&(null==S?void 0:S.length)>0&&t.createElement(P.default,{passenger:O,currentProduct:p,products:S,changeCurrentProduct:this.changeCurrentProduct}),!b&&(null==p?void 0:null==(u=p.priceOptions[0])?void 0:u.amountInOere)&&t.createElement(n.View,{style:k.container},t.createElement(s.SmallText,null,(0,v.default)('price')+':'),t.createElement(s.SmallTextBold,null,M)),b&&t.createElement(n.View,{style:{marginTop:24,alignItems:'center'}},t.createElement(s.ActivityDotsIndicator,{style:{marginLeft:-8}})))),t.createElement(s.PrimaryButton,{loading:_,onPress:this.handleContinueToPaymentPress,disabled:!p||_,containerStyle:{margin:18}},(0,v.default)('go_to_payment')))}}])&&C(E.prototype,j),x&&C(E,x),S})();e.default=j},1531,[7,10,1294,653,1296,642,1236,636,1532,1533,1521,1522,1472]);