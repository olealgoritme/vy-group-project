__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=M();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(o,l,c):o[l]=t[l]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),l=r(d[4]),c=r(d[5]),u=r(d[6]),p=r(d[7]),f=V(r(d[8])),h=V(r(d[9])),S=V(r(d[10])),y=V(r(d[11])),b=V(r(d[12])),v=V(r(d[13])),O=V(r(d[14])),w=V(r(d[15]));function V(t){return t&&t.__esModule?t:{default:t}}function M(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return M=function(){return t},t}function j(t,n){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),o.push.apply(o,s)}return o}function P(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?j(Object(o),!0).forEach(function(n){R(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):j(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function R(t,n,o){return n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function E(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Z(t){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}function C(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function k(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function z(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&D(t,n)}function D(t,n){return(D=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var L={container:{padding:24,paddingTop:36,backgroundColor:p.colors.white,marginBottom:24},switchButton:{position:'absolute',alignSelf:'flex-end',paddingRight:6},line:{marginLeft:18,marginRight:58,width:null}},N=(function(p){function h(t){var n,o,s;return C(this,h),o=this,(n=!(s=T(h).call(this,t))||"object"!=typeof s&&"function"!=typeof s?x(o):s).state={stops:[],zones:[],recentStops:[],nearbyStops:[],isStopSearchModalVisible:!1,isViaZoneModalVisible:!1,currentSearchType:'FROM'},n.onOpenStopSearchModal=n.onOpenStopSearchModal.bind(x(n)),n.onCloseStopSearchModal=n.onCloseStopSearchModal.bind(x(n)),n.toggleViaZoneModal=n.toggleViaZoneModal.bind(x(n)),n}var V,M,j;return z(h,t.Component),V=h,(M=[{key:"componentDidMount",value:function(){this.getStops(),this.getRecentStops(),this.handleLocationRequest()}},{key:"componentDidUpdate",value:function(t,n){var o=this,s=this.props,l=s.availableViaZones,c=s.currentViaZone,u=s.location,p=this.state,h=p.isViaZoneModalVisible,S=p.stops;((null==S?void 0:S.length)&&S!==n.stops||u&&!t.location||u&&t.location&&(0,f.default)(t.location,u)>.1)&&this.updateNearbyStops(),(null==l?void 0:l.length)&&!c&&!h&&setTimeout(function(){return o.setState({isViaZoneModalVisible:!0})},100)}},{key:"handleLocationRequest",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this.props.onRequestStatus());case 2:if('notDetermined'!==this.props.locationAuthorization){t.next=7;break}return t.next=5,regeneratorRuntime.awrap(this.props.onRequestLocationPermission());case 5:return t.next=7,regeneratorRuntime.awrap(this.props.onRequestStatus());case 7:case"end":return t.stop()}},null,this)}},{key:"updateNearbyStops",value:function(){var t=this.props,n=t.changeStop,o=t.location,s=t.useCurrentPosition,c=t.useCurrentPositionToStop,u=void 0===c||c,p=t.fromStop,f=t.toStop,h=(0,l.findNearbyLocalOperatorStop)(this.state.stops,o).slice(0,3);if(this.setState({nearbyStops:h}),s&&(null==h?void 0:h.length)&&(!p||!f)){if(!p){var S=JSON.parse(JSON.stringify(h[0].zones[0]));S.isCurrentLocation=!0,n('FROM',S)}if(!f&&u){var y=JSON.parse(JSON.stringify(h[0].zones[0]));y.showChooseStopString=!0,n('TO',y)}}}},{key:"getStops",value:function(){var t,o,l,c;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return this.setState({stops:[]}),u.prev=1,u.next=4,regeneratorRuntime.awrap((0,s.getLocalOperatorStopListFromCacheThenRemote)());case 4:(t=u.sent).length||n.Alert.alert((0,w.default)('no_stop_place_found_alert')),o=this.props.operator,l=t.filter(function(t){return t.operators.includes(o)}),c=(p=new Set(l.map(function(t){return t.zones[0].id})),_(p)||Z(p)||E()).map(function(t){return l.find(function(n){return n.zones[0].id===t}).zones[0]}).sort(function(t,n){return t.id.localeCompare(n.id)}).map(function(t){return P({},t,{type:'ZONE'})}),this.setState({stops:l,zones:c}),u.next=15;break;case 12:u.prev=12,u.t0=u.catch(1),console.log('Something failed while retrieving stops with error:',u.t0);case 15:case"end":return u.stop()}var p},null,this,[[1,12]])}},{key:"getRecentStops",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return this.setState({recentStops:[]}),n.next=3,regeneratorRuntime.awrap((0,u.getRecentSearchLocalOperatorStop)(5,this.props.operator));case 3:(null==(t=n.sent)?void 0:t.length)&&this.setState({recentStops:t});case 5:case"end":return n.stop()}},null,this)}},{key:"onOpenStopSearchModal",value:function(t){this.setState({isStopSearchModalVisible:!0,currentSearchType:t})}},{key:"onCloseStopSearchModal",value:function(){this.setState({isStopSearchModalVisible:!1})}},{key:"toggleViaZoneModal",value:function(){this.setState(function(t){return{isViaZoneModalVisible:!t.isViaZoneModalVisible}})}},{key:"render",value:function(){var s=this.props,l=s.availableViaZones,u=s.currentViaZone,p=s.changeCurrentViaZone,f=s.fromStop,h=s.toStop,V=s.headerText,M=s.style;return t.createElement(t.Fragment,null,t.createElement(o.NavigationEvents,{onWillFocus:this.props.onRequestStatus}),t.createElement(S.default,{toActive:this.props.onRequestStatus}),t.createElement(n.View,{style:[L.container,M]},!!V&&t.createElement(n.View,null,V),t.createElement(n.View,{style:{justifyContent:'center'}},t.createElement(y.default,{type:'FROM',stop:f,onPress:this.onOpenStopSearchModal}),u?t.createElement(v.default,{currentViaZone:u,openViaZoneModal:this.toggleViaZoneModal}):t.createElement(n.View,{style:{height:12}}),t.createElement(y.default,{type:'TO',stop:h,onPress:this.onOpenStopSearchModal}),t.createElement(n.TouchableOpacity,{onPress:this.props.flipDirection,style:L.switchButton,accessibilityRole:"button",accessibilityLabel:(0,w.default)('swap_station')},t.createElement(n.Image,{source:c.switchVertical,resizeMode:'contain',style:{height:44}})))),t.createElement(b.default,{type:this.state.currentSearchType,isVisible:this.state.isStopSearchModalVisible,onClose:this.onCloseStopSearchModal,stops:this.state.stops,zones:this.state.zones,recentStops:this.state.recentStops,nearbyStops:this.state.nearbyStops,onStopSelected:this.props.changeStop}),(null==l?void 0:l.length)>0&&p?t.createElement(O.default,{availableViaZones:l,currentViaZone:u,changeCurrentViaZone:p,isVisible:this.state.isViaZoneModalVisible,onClose:this.toggleViaZoneModal}):null)}}])&&k(V.prototype,M),j&&k(V,j),h})(),A=(0,h.default)(N);e.default=A},1522,[7,10,435,625,1446,675,645,414,1395,1454,1455,1523,1524,1529,1530,1472]);