__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=I();if(n&&n.has(t))return n.get(t);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var u=o?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(s,l,u):s[l]=t[l]}s.default=t,n&&n.set(t,s);return s})(r(d[0])),n=r(d[1]),s=r(d[2]),o=r(d[3]),l=r(d[4]),u=r(d[5]),c=r(d[6]),f=r(d[7]),p=r(d[8]),h=r(d[9]),y=r(d[10]),v=r(d[11]),b=j(r(d[12])),O=j(r(d[13])),w=j(r(d[14])),L=j(r(d[15])),R=j(r(d[16])),S=j(r(d[17])),E=j(r(d[18])),_=j(r(d[19])),C=j(r(d[20])),k=j(r(d[21])),x=r(d[22]),P=r(d[23]);function j(t){return t&&t.__esModule?t:{default:t}}function I(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return I=function(){return t},t}function M(){return(M=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=s[o])}return t}).apply(this,arguments)}function T(t,n){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,o)}return s}function D(t){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?T(Object(s),!0).forEach(function(n){F(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function F(t,n,s){return n in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t}function A(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function B(t,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&V(t,n)}function V(t,n){return(V=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var z=(function(n){function u(t){var n,s,o;return A(this,u),s=this,(n=!(o=G(u).call(this,t))||"object"!=typeof o&&"function"!=typeof o?N(s):o).state={isRefreshing:!1,hasRefreshed:!1,isCreatingOrder:!1,isChangingLeg:!1,itinerary:n.props.navigation.state.params.itinerary},n.swipeableLegRefs={},n.handleRefresh=n.handleRefresh.bind(N(n)),n.renderLegWrapper=n.renderLegWrapper.bind(N(n)),n.renderLeg=n.renderLeg.bind(N(n)),n.renderLegFooter=n.renderLegFooter.bind(N(n)),n}var j,I,M;return W(u,t.Component),j=u,(I=[{key:"navigateToNextScreen",value:function(){var t,n,o,l,u,f;return regeneratorRuntime.async(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,regeneratorRuntime.awrap((0,x.isUserLoggedIn)());case 2:if(t=y.sent,n=(0,h.resolveNextScreenAfterDepartureDetails)(t,this.state.itinerary),!['OrderConfirmation','AccommodationChooser','BookingLoginScreen'].includes(n)){y.next=26;break}return y.prev=5,this.setState({isCreatingOrder:!0}),o=this.state.itinerary.id,y.next=10,regeneratorRuntime.awrap((0,p.createOrder)(o,'LOCAL'));case 10:return l=y.sent,u=l.id,y.next=14,regeneratorRuntime.awrap((0,p.getOrder)(u));case 14:f=y.sent,this.props.navigation.navigate(n,D({},this.props.navigation.state.params,{itinerary:this.state.itinerary,orderId:u,order:f})),y.next=21;break;case 18:y.prev=18,y.t0=y.catch(5),s.Alert.alert((0,k.default)('order_or_payment_failed_alert_title'),(0,c.getMessageFromErrorIfPresent)(y.t0)||(0,k.default)('initiate_order_failed_generic_message'));case 21:return y.prev=21,this.setState({isCreatingOrder:!1}),y.finish(21);case 24:y.next=27;break;case 26:this.props.navigation.navigate('PriceOptions',D({},this.props.navigation.state.params,{itinerary:this.state.itinerary}));case 27:case"end":return y.stop()}},null,this,[[5,18,21,24]])}},{key:"handleRefresh",value:function(){this.setState({isRefreshing:!0}),this.getItinerary()}},{key:"handleChangeLeg",value:function(t,n,o){var l,u,c=this;return regeneratorRuntime.async(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,this.setState({isChangingLeg:!0}),l='earlier'===o?p.changeToEarlierLeg:p.changeToLaterLeg,f.next=5,regeneratorRuntime.awrap(l(t,n));case 5:u=f.sent,this.setState({itinerary:u}),f.next=12;break;case 9:f.prev=9,f.t0=f.catch(0),s.Alert.alert((0,k.default)('change_leg_failed_alert_title'),(0,k.default)('change_leg_failed_alert_message'),[{text:(0,k.default)('try_again'),onPress:function(){return c.handleChangeLeg(t,n,o)}},{text:(0,k.default)('cancel'),style:'cancel',onPress:function(){var t,s;return null==(t=c.swipeableLegRefs)?void 0:null==(s=t[n].current)?void 0:s.close()}}]);case 12:return f.prev=12,this.setState({isChangingLeg:!1}),b.default.CHANGED_LEG({direction:o}),f.finish(12);case 16:case"end":return f.stop()}},null,this,[[0,9,12,16]])}},{key:"getItinerary",value:function(){var t,n;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,t=this.state.itinerary,o.next=4,regeneratorRuntime.awrap((0,p.fetchRefreshedItineraries)(t.id));case 4:n=o.sent,this.setItinerary(n),o.next=12;break;case 8:o.prev=8,o.t0=o.catch(0),this.setState({isRefreshing:!1}),s.Alert.alert((0,k.default)('refresh_failed'),(0,c.getMessageFromErrorIfPresent)(o.t0)||'');case 12:case"end":return o.stop()}},null,this,[[0,8]])}},{key:"setItinerary",value:function(t){this.setState({isRefreshing:!1,itinerary:t.itineraries[0]})}},{key:"renderLegWrapper",value:function(n){var s=this,o=n.children,l=n.leg,u=this.state.itinerary;return u.changeLegAvailable?(this.swipeableLegRefs.hasOwnProperty(l.id)||(this.swipeableLegRefs[l.id]=t.createRef()),t.createElement(_.default,{ref:this.swipeableLegRefs[l.id],enabled:!this.state.isChangingLeg,onLeftDrag:function(){return s.handleChangeLeg(u.id,l.id,'earlier')},onRightDrag:function(){return s.handleChangeLeg(u.id,l.id,'later')}},o)):t.createElement(t.Fragment,null,o)}},{key:"renderLeg",value:function(n){var s=n.leg;return t.createElement(S.default,{leg:s})}},{key:"renderLegFooter",value:function(n){var s=this,o=n.leg;return this.state.itinerary.changeLegAvailable?t.createElement(E.default,{disabled:this.state.isChangingLeg,onChangeEarlierLeg:function(){var t,n;return null==(t=s.swipeableLegRefs)?void 0:null==(n=t[o.id].current)?void 0:n.openLeft()},onChangeLaterLeg:function(){var t,n;return null==(t=s.swipeableLegRefs)?void 0:null==(n=t[o.id].current)?void 0:n.openRight()}}):null}},{key:"render",value:function(){var n,u,c,p=this,b=this.props.navigation.state.params,S=b.passengerCategories,E=b.passengers,_=this.state.itinerary,x=_.duration,j=(null==(n=_.tripStatus)?void 0:n.bookable)&&!(0,f.isOnlyInfants)(E),I={ticketId:'',stationFrom:_.from,stationTo:_.to,validFrom:_.departureScheduled,validTo:_.arrivalScheduled,legs:[]};return _.priceOptions&&null===(null==(u=(0,h.getCheapestPriceOption)(_.priceOptions))?void 0:u.amountInOere)&&P.remoteLogger.info(P.sources.BOOKING,"Mangler pris p\xe5 priceOption",_&&JSON.stringify(_)),t.createElement(o.ScreenView,{style:{backgroundColor:v.colors.brightGrey}},t.createElement(O.default,{toActive:this.handleRefresh}),t.createElement(s.View,{ref:this.props.forwardedRef,style:{zIndex:10,backgroundColor:v.colors.white}},t.createElement(R.default,{itinerary:_,durationString:(0,l.renderDuration)(x)})),t.createElement(s.ScrollView,{contentContainerStyle:{paddingTop:30,paddingBottom:100,flexGrow:1,justifyContent:'space-between',backgroundColor:v.colors.brightGrey},refreshControl:t.createElement(s.RefreshControl,{refreshing:this.state.isRefreshing,onRefresh:this.handleRefresh})},t.createElement(s.View,null,!!_.tripStatus&&!!_.tripStatus.shortMessage&&t.createElement(s.View,{style:C.default.tripStatusMessage},t.createElement(o.MediumTextBold,{style:{marginBottom:5}},_.tripStatus&&_.tripStatus.shortMessage),t.createElement(o.MediumText,null,_.tripStatus&&_.tripStatus.longMessage)),_.messages.length>0&&_.messages.map(function(n,l){return t.createElement(s.View,{key:l,style:[C.default.tripStatusMessage,{flexDirection:'row',alignItems:'center'},'INFO'===n.type&&{backgroundColor:v.colors.lightGreen}]},t.createElement(s.Image,{source:'INFO'===n.type?y.infoIcon:y.smallWarning,style:{resizeMode:'contain',marginRight:12}}),t.createElement(o.MediumText,{style:{flex:1}},n.text))}),t.createElement(w.default,{itinerary:_,renderLeg:this.renderLeg,renderLegFooter:this.renderLegFooter,addWrapper:this.renderLegWrapper}),t.createElement(s.View,{style:C.default.addToCalendarButton},t.createElement(o.AddToCalendarButton,{ticket:I})))),t.createElement(L.default,{isLoading:this.state.isCreatingOrder,text:(0,k.default)(j?'go_further':'close'),onPress:function(){j?p.navigateToNextScreen():p.props.navigation.goBack(null)}},t.createElement(H,{isBookable:j,priceOptions:null!=(c=_.priceOptions)?c:[],passengerSummary:(0,f.getPassengerSelectionSummary)(E,S),passengers:E,tripStatus:_.tripStatus})))}}])&&B(j.prototype,I),M&&B(j,M),u})(),H=function(n){var l,c=n.passengerSummary,p=n.isBookable,y=n.priceOptions,b=n.passengers,O=n.tripStatus,w=(0,u.getAmountFromOereWithCurrency)(null==(l=(0,h.getCheapestPriceOption)(y))?void 0:l.amountInOere),L=y.filter(function(t){return t.price>0}).length>0,R=c+'. '+(0,k.default)('from')+' '+w;return t.createElement(s.View,{accessible:!0,accessibilityRole:"summary",accessibilityLabel:R,style:{paddingRight:12}},(0,f.isOnlyInfants)(b)&&O?t.createElement(o.SmallText,{mediumGrey:!0},(0,k.default)('purchase_error')+" "+c+" "+(0,k.default)('alone')):t.createElement(o.MediumText,null,c),p&&t.createElement(o.MediumTextBold,{style:{color:v.colors.darkGrey}},(L?(0,k.default)('from')+' ':'')+w))},J=(0,n.withNavigation)(t.forwardRef(function(n,s){return t.createElement(z,M({},n,{forwardedRef:s}))}));e.default=J},1886,[7,435,10,653,670,1236,636,1296,642,1228,675,414,1294,1455,1887,1741,1890,1892,1894,1895,1897,1234,639,633]);