__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=S();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var c=s?Object.getOwnPropertyDescriptor(t,u):null;c&&(c.get||c.set)?Object.defineProperty(o,u,c):o[u]=t[u]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=E(r(d[3])),u=r(d[4]),c=r(d[5]),l=r(d[6]),p=r(d[7]),f=r(d[8]),h=E(r(d[9])),v=E(r(d[10])),y=E(r(d[11])),P=E(r(d[12])),b=E(r(d[13]));function E(t){return t&&t.__esModule?t:{default:t}}function S(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return S=function(){return t},t}function Z(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function x(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&C(t,n)}function C(t,n){return(C=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var V={container:{paddingHorizontal:24,backgroundColor:f.colors.white,paddingBottom:18},priceContainer:{margin:24,flexDirection:'row',justifyContent:'space-between',alignItems:'center',marginBottom:12}},k=(function(o){function f(t){var n,o,s;return Z(this,f),o=this,(n=!(s=O(f).call(this,t))||"object"!=typeof s&&"function"!=typeof s?T(o):s).state={isLoadingProducts:!1,products:[],currentViaZone:void 0,availableViaZones:[],existingTickets:[],productErrorMessage:void 0,currentProduct:void 0,productMessages:[]},n.getProducts=n.getProducts.bind(T(n)),n.changeCurrentViaZone=n.changeCurrentViaZone.bind(T(n)),n.changeCurrentProduct=n.changeCurrentProduct.bind(T(n)),n.navigateToManualExtraZones=n.navigateToManualExtraZones.bind(T(n)),n.handleContinueToPaymentPress=n.handleContinueToPaymentPress.bind(T(n)),n}var E,S,C;return w(f,t.Component),E=f,(S=[{key:"componentDidUpdate",value:function(t,n){var o=this.props,s=o.fromStop,u=o.toStop,c=s&&u,l=t.fromStop!==s||t.toStop!==u;c&&l&&this.getAvailableViaZones()}},{key:"changeCurrentViaZone",value:function(t){this.setState({currentViaZone:t},this.getProducts)}},{key:"getAvailableViaZones",value:function(){var t,n,o,s,u;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.setState({availableViaZones:[],currentViaZone:void 0,productErrorMessage:void 0}),t=this.props,n=t.fromStop,o=t.toStop,!n||!o){l.next=18;break}if(l.prev=3,this.setState({isLoadingProducts:!0}),'ZONE'!==n.type&&'ZONE'!==o.type){l.next=7;break}return l.abrupt("return",this.getProducts());case 7:return l.next=9,regeneratorRuntime.awrap((0,c.fetchLocalOperatorAvailableViaZones)(n.id,o.id));case 9:s=l.sent,u=s.availableViaZones,this.setState({availableViaZones:u}),u.length||this.getProducts(),l.next=18;break;case 15:l.prev=15,l.t0=l.catch(3),this.getProducts();case 18:case"end":return l.stop()}},null,this,[[3,15]])}},{key:"getProducts",value:function(){var t,n,o,s,u,l,f,h,v,y=this;return regeneratorRuntime.async(function(P){for(;;)switch(P.prev=P.next){case 0:if(t=this.props,n=t.fromStop,o=t.toStop,s=this.state.currentViaZone,n&&o){P.next=4;break}return P.abrupt("return");case 4:return this.setState({currentProduct:void 0}),P.prev=5,u=new Date,P.next=9,regeneratorRuntime.awrap((0,c.fetchLocalOperatorExtraZonesProducts)(n.id,o.id,null==s?void 0:s.zoneId));case 9:l=P.sent,f=new Date-u,h=f<=750?750-f:0,this.setState({currentProduct:l.products[0],products:l.products,existingTickets:l.existingTickets,productMessages:l.messages}),setTimeout(function(){return y.setState({isLoadingProducts:!1})},h),P.next=20;break;case 16:P.prev=16,P.t0=P.catch(5),v=(0,p.getMessageFromErrorIfPresent)(P.t0)||(0,b.default)('no_tickets_found'),this.setState({isLoadingProducts:!1,productErrorMessage:v,products:[],existingTickets:[]});case 20:case"end":return P.stop()}},null,this,[[5,16]])}},{key:"changeCurrentProduct",value:function(t){this.setState({currentProduct:t})}},{key:"navigateToManualExtraZones",value:function(){var t=this.props,n=t.operator,o=t.fromStop,s=t.toStop;o&&s&&this.props.navigation.navigate('ManualExtraZonesScreen',{fromStop:o,toStop:s,viaZone:this.state.currentViaZone,operator:n})}},{key:"handleContinueToPaymentPress",value:function(){s.default.RUTER_CONTINUE_TO_PAYMENT({from:'Extra Zones',operator:this.props.operator}),this.props.navigateToOrderConfirmation(this.state.currentProduct)}},{key:"render",value:function(){var o,s,c=this.props,p=c.isCreatingOrder,f=c.operator,E=c.fromStop,S=c.toStop,Z=c.changeStop,x=c.flipDirection,O=this.state,T=O.isLoadingProducts,w=O.currentViaZone,C=O.availableViaZones,k=O.existingTickets,_=O.products,M=O.productErrorMessage,j=O.currentProduct,L=O.productMessages,D=t.createElement(u.SmallText,{mediumGrey:!0,style:{marginBottom:18}},(0,b.default)('extra_ticket_message')+':'),B=E&&S&&(M||T),R=(0,l.getAmountFromOereWithCurrency)(null==j?void 0:null==(o=j.priceOptions[0])?void 0:o.amountInOere);return t.createElement(n.View,{style:{flex:1}},t.createElement(n.ScrollView,{keyboardShouldPersistTaps:"always",contentContainerStyle:{paddingBottom:100}},t.createElement(y.default,{messages:L}),t.createElement(h.default,{useCurrentPosition:!0,useCurrentPositionToStop:!1,toStop:S,fromStop:E,changeStop:Z,flipDirection:x,availableViaZones:C,currentViaZone:w,changeCurrentViaZone:this.changeCurrentViaZone,operator:f,headerText:D,style:{marginBottom:0}}),t.createElement(n.View,{style:V.container},t.createElement(u.Fade,{isVisible:!!E&&!!S&&!M},t.createElement(P.default,{isLoadingProducts:T,currentProduct:j,changeCurrentProduct:this.changeCurrentProduct,tickets:k,products:_,navigateToManualExtraZones:this.navigateToManualExtraZones})),B&&t.createElement(v.default,{isLoading:T,errorMessage:M,navigateToManualExtraZones:this.navigateToManualExtraZones})),!T&&(null==j?void 0:null==(s=j.priceOptions[0])?void 0:s.amountInOere)&&t.createElement(n.View,{style:V.priceContainer},t.createElement(u.SmallText,null,(0,b.default)('price')+':'),t.createElement(u.SmallTextBold,null,R))),t.createElement(u.Fade,{isVisible:!!j},t.createElement(u.PrimaryButton,{loading:p,onPress:this.handleContinueToPaymentPress,disabled:!j||p,containerStyle:{margin:18}},(0,b.default)('go_to_payment'))))}}])&&x(E.prototype,S),C&&x(E,C),f})(),_=(0,o.withNavigation)(k);e.default=_},1534,[7,10,435,1294,653,642,1236,636,414,1522,1535,1521,1536,1472]);