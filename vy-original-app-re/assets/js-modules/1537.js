__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=k();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var u=s?Object.getOwnPropertyDescriptor(t,c):null;u&&(u.get||u.set)?Object.defineProperty(o,c,u):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),c=r(d[4]),u=r(d[5]),l=r(d[6]),p=P(r(d[7])),f=r(d[8]),h=P(r(d[9])),v=P(r(d[10])),y=P(r(d[11])),S=P(r(d[12])),b=P(r(d[13]));function P(t){return t&&t.__esModule?t:{default:t}}function k(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return k=function(){return t},t}function O(t){return _(t)||w(t)||T()}function T(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function w(t){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}function C(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Z(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&j(t,n)}function j(t,n){return(j=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var R={container:{marginTop:18,flexDirection:'row',justifyContent:'space-between',alignItems:'center',marginBottom:12}},M=(function(P){function k(t){var n,o,s;return C(this,k),o=this,(n=!(s=E(k).call(this,t))||"object"!=typeof s&&"function"!=typeof s?V(o):s).state={isCreatingOrder:!1,isLoadingProducts:!1,toStopTicket:void 0,fromStopTicket:void 0,passenger:void 0,passengerCategories:[],currentViaZone:void 0,availableViaZones:[],currentProduct:void 0,productMessages:[]},n.getProducts=n.getProducts.bind(V(n)),n.changeStop=n.changeStop.bind(V(n)),n.flipDirection=n.flipDirection.bind(V(n)),n.changeCurrentViaZone=n.changeCurrentViaZone.bind(V(n)),n.changePassenger=n.changePassenger.bind(V(n)),n.navigateToOrderConfirmation=n.navigateToOrderConfirmation.bind(V(n)),n.handleContinueToPaymentPress=n.handleContinueToPaymentPress.bind(V(n)),n}var T,w,_;return x(k,t.Component),T=k,(w=[{key:"componentDidUpdate",value:function(t,n){var o=this.state,s=o.fromStopTicket,c=o.toStopTicket,u=s&&c,l=n.fromStopTicket!==s||n.toStopTicket!==c;u&&l&&this.getAvailableViaZones()}},{key:"changePassenger",value:function(t){this.setState({passenger:t},this.getProducts)}},{key:"changeCurrentViaZone",value:function(t){this.setState({currentViaZone:t},this.getProducts)}},{key:"changeStop",value:function(t,n){var o,s,c;this.setState((o={},c=n,(s='FROM'===t?'fromStopTicket':'toStopTicket')in o?Object.defineProperty(o,s,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[s]=c,o))}},{key:"flipDirection",value:function(){this.state.fromStopTicket&&this.state.toStopTicket&&this.setState(function(t){return{fromStopTicket:t.toStopTicket,toStopTicket:t.fromStopTicket}})}},{key:"getAvailableViaZones",value:function(){var t,n,o,c,u;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:if(t=this.state,n=t.fromStopTicket,o=t.toStopTicket,n&&o){l.next=3;break}return l.abrupt("return");case 3:if(l.prev=3,this.setState({isLoadingProducts:!0,availableViaZones:[],currentViaZone:void 0}),'ZONE'!==n.type&&'ZONE'!==o.type){l.next=7;break}return l.abrupt("return",this.getProducts());case 7:return l.next=9,regeneratorRuntime.awrap((0,s.fetchLocalOperatorAvailableViaZones)(n.id,o.id));case 9:c=l.sent,u=c.availableViaZones,this.setState({availableViaZones:u}),u.length||this.getProducts(),l.next=18;break;case 15:l.prev=15,l.t0=l.catch(3),this.getProducts();case 18:case"end":return l.stop()}},null,this,[[3,15]])}},{key:"getProducts",value:function(){var t,n,o,c,u,p,f,h,v,y,b,P,k,O,T,w,_=this;return regeneratorRuntime.async(function(C){for(;;)switch(C.prev=C.next){case 0:if(t=this.props.navigation.state.params,n=t.fromStop,o=t.toStop,c=t.viaZone,u=this.state,p=u.fromStopTicket,f=u.toStopTicket,h=u.currentViaZone,v=u.passenger,p&&f){C.next=4;break}return C.abrupt("return");case 4:return C.prev=4,this.setState({isLoadingProducts:!0,currentProduct:void 0}),y=new Date,b={from:p.id,to:f.id,viaZone:null==h?void 0:h.zoneId},P={from:n.id,to:o.id,viaZone:null==c?void 0:c.zoneId},C.next=11,regeneratorRuntime.awrap((0,s.fetchLocalOperatorManualExtraZonesProducts)(P,b,v));case 11:k=C.sent,O=new Date-y,T=O<=750?750-O:0,this.setProducts(k),setTimeout(function(){return _.setState({isLoadingProducts:!1})},T),C.next=22;break;case 18:C.prev=18,C.t0=C.catch(4),w=(0,l.getMessageFromErrorIfPresent)(C.t0)||(0,S.default)('no_products_found'),this.setState({isLoadingProducts:!1,productMessages:[{text:w,type:'ERROR'}]});case 22:case"end":return C.stop()}},null,this,[[4,18]])}},{key:"setProducts",value:function(t){this.setState({currentProduct:t.products[0],passenger:t.passengerInformation.passengers[0],passengerCategories:t.passengerInformation.availableCategories,productMessages:t.messages})}},{key:"setRecentSearchLocalOperatorStop",value:function(){var t=this.props.navigation.state.params.operator,n=this.state,o=n.fromStopTicket,s=n.toStopTicket;if(t&&o&&s){var u=[].concat(O('STOP'===s.type?[s]:[]),O('STOP'===o.type?[o]:[]));(0,c.setRecentSearchLocalOperatorStop)(t,u)}}},{key:"navigateToOrderConfirmation",value:function(t){var o,c,u;return regeneratorRuntime.async(function(p){for(;;)switch(p.prev=p.next){case 0:if(t){p.next=2;break}return p.abrupt("return");case 2:return this.setRecentSearchLocalOperatorStop(),p.prev=3,this.setState({isCreatingOrder:!0}),p.next=7,regeneratorRuntime.awrap((0,s.createOrderPeriodTicket)(t.id));case 7:return o=p.sent,c=o.id,p.next=11,regeneratorRuntime.awrap((0,s.getOrder)(c));case 11:u=p.sent,this.props.navigation.navigate('PeriodTicketOrderConfirmation',{orderId:c,order:u,previousStack:{routeName:this.props.navigation.state.routeName,key:this.props.navigation.state.key,firstRouteName:'NewTicketScreen'}}),p.next=18;break;case 15:p.prev=15,p.t0=p.catch(3),n.Alert.alert((0,S.default)('order_or_payment_failed_alert_title'),(0,l.getMessageFromErrorIfPresent)(p.t0)||(0,S.default)('initiate_order_failed_generic_message'));case 18:return p.prev=18,this.setState({isCreatingOrder:!1}),p.finish(18);case 21:case"end":return p.stop()}},null,this,[[3,15,18,21]])}},{key:"handleContinueToPaymentPress",value:function(){p.default.RUTER_CONTINUE_TO_PAYMENT({from:'Manual Extra Zones',operator:this.props.operator}),this.navigateToOrderConfirmation(this.state.currentProduct)}},{key:"render",value:function(){var s,c,l=this.props.navigation.state.params,p=l.viaZone,P=l.fromStop,k=l.toStop,O=l.operator,T=this.state,w=T.isCreatingOrder,_=T.isLoadingProducts,C=T.currentViaZone,Z=T.availableViaZones,E=T.fromStopTicket,V=T.toStopTicket,x=T.currentProduct,j=T.passenger,M=T.passengerCategories,I=T.productMessages,A=(0,u.getAmountFromOereWithCurrency)(null==x?void 0:null==(s=x.priceOptions[0])?void 0:s.amountInOere);return t.createElement(o.ScreenView,{style:{backgroundColor:f.colors.brightGrey}},t.createElement(n.ScrollView,{keyboardShouldPersistTaps:"always",contentContainerStyle:{paddingBottom:100}},t.createElement(v.default,{messages:I}),t.createElement(b.default,{fromStop:P,toStop:k,viaZone:p}),t.createElement(y.default,{toStop:V,fromStop:E,changeStop:this.changeStop,flipDirection:this.flipDirection,availableViaZones:Z,currentViaZone:C,changeCurrentViaZone:this.changeCurrentViaZone,operator:O}),t.createElement(n.View,{style:{marginHorizontal:24}},j&&(null==M?void 0:M.length)>0&&t.createElement(h.default,{key:null==j?void 0:j.type,passenger:j,passengerCategories:M,changePassenger:this.changePassenger}),!_&&(null==x?void 0:null==(c=x.priceOptions[0])?void 0:c.amountInOere)&&t.createElement(n.View,{style:R.container},t.createElement(o.SmallText,null,(0,S.default)('price')+':'),t.createElement(o.SmallTextBold,null,A)),_&&t.createElement(n.View,{style:{marginTop:24,alignItems:'center'}},t.createElement(o.ActivityDotsIndicator,{style:{marginLeft:-8}})))),t.createElement(o.PrimaryButton,{loading:w,onPress:this.handleContinueToPaymentPress,disabled:!x||w,containerStyle:{margin:18}},(0,S.default)('go_to_payment')))}}])&&Z(T.prototype,w),_&&Z(T,_),k})();M.navigationOptions=function(t){t.navigation;return{headerTitle:(0,S.default)('extra_zones')}};var I=M;e.default=I},1537,[7,10,653,642,645,1236,636,1294,414,1532,1521,1522,1472,1538]);