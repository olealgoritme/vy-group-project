__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var o=q();if(o&&o.has(t))return o.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(n,l,u):n[l]=t[l]}n.default=t,o&&o.set(t,n);return n})(r(d[0])),o=r(d[1]),n=j(r(d[2])),s=j(r(d[3])),l=j(r(d[4])),u=j(r(d[5])),c=j(r(d[6])),f=j(r(d[7])),h=r(d[8]),p=j(r(d[9])),y=j(r(d[10])),S=j(r(d[11])),v=j(r(d[12])),b=r(d[13]),E=r(d[14]),M=r(d[15]),w=j(r(d[16])),O=j(r(d[17])),V=j(r(d[18])),A=j(r(d[19])),B=r(d[20]),_=j(r(d[21])),k=j(r(d[22])),P=j(r(d[23])),C=j(r(d[24])),T=(r(d[25]),j(r(d[26])));function j(t){return t&&t.__esModule?t:{default:t}}function q(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return q=function(){return t},t}function F(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function I(t,o){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],s=!0,l=!1,u=void 0;try{for(var c,f=t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();!(s=(c=f.next()).done)&&(n.push(c.value),!o||n.length!==o);s=!0);}catch(t){l=!0,u=t}finally{try{s||null==f.return||f.return()}finally{if(l)throw u}}return n}}function L(t){if(Array.isArray(t))return t}function R(t,o,n){return o in t?Object.defineProperty(t,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[o]=n,t}function x(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function D(t,o){for(var n=0;n<o.length;n++){var s=o[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function Q(t){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function N(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),o&&W(t,o)}function W(t,o){return(W=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t})(t,o)}var Z=(function(O){function j(t){var o,n,s;return x(this,j),n=this,s=Q(j).call(this,t),(o=!s||"object"!=typeof s&&"function"!=typeof s?z(n):s).trackEmptySearch=(0,k.default)(function(t){0===(0,b.filterStationsByQuery)(o.props.stations,t).length&&w.default.EMPTY_SEARCH_RESULT({query:t})},1e3,!1),o.state={query:'',fromStation:void 0,toStation:void 0,bybilModalVisible:!1,showClearButton:!1,isSearchingForArrivalStation:!1,typeActive:'',isErrorModalVisible:!1},o.toggleBybilModal=o.toggleBybilModal.bind(z(o)),o.resetSearch=o.resetSearch.bind(z(o)),o.setTypeActive=o.setTypeActive.bind(z(o)),o.handleClearFromStation=o.handleClearFromStation.bind(z(o)),o.toggleErrorModalVisible=o.toggleErrorModalVisible.bind(z(o)),o}var q,W,Z;return N(j,t.Component),q=j,(W=[{key:"resetSearch",value:function(){o.Keyboard.dismiss(),this.setState({fromStation:void 0,toStation:void 0,query:'',isSearchingForArrivalStation:!1,showClearButton:!1,typeActive:''})}},{key:"setTypeActive",value:function(t){this.setState({typeActive:t})}},{key:"onStationSelected",value:function(t){var o,n=this,s=!!this.state.fromStation,l=(R(o={},s?'toStation':'fromStation',t),R(o,"query",''),o);this.setState(l,function(){return n.state.fromStation&&n.setState({showClearButton:!0})}),s&&this.state.fromStation?this.onBothStationsSelected(this.state.fromStation,t):this.setTypeActive(l.fromStation.type)}},{key:"onBothStationsSelected",value:function(t,o){var n=this;if(!(t.type===o.type)&&!this.props.useBetaTravelPlanner)return w.default.ILLEGAL_MODALITY_COMBINATION({fromStationType:t.type,toStationType:o.type,fromStationName:t.name,toStationName:o.name}),void this.toggleErrorModalVisible();setTimeout(function(){return n.setState({toStation:void 0})},500),this.props.onStationSelectFinished({from:t,to:o})}},{key:"removeSelectedStations",value:function(t){var o=this.state.fromStation&&this.state.fromStation.name,n=this.state.toStation&&this.state.toStation.name;return t.filter(function(t){var s=t.name;return s!==o&&s!==n})}},{key:"handleClearFromStation",value:function(){this.setState({fromStation:void 0,toStation:void 0,isSearchingForArrivalStation:!1,showClearButton:!1,typeActive:void 0})}},{key:"handleQueryChanged",value:function(t){this.setState({query:t});var o=this.state.query.length<t.length,n=''!==t,s=this.props.stations.length>0;o&&n&&s&&this.trackEmptySearch(t)}},{key:"handleClearQuery",value:function(){this.setState({query:''})}},{key:"toggleErrorModalVisible",value:function(){this.setState(function(t){return{isErrorModalVisible:!t.isErrorModalVisible}}),this.handleClearFromStation()}},{key:"toggleBybilModal",value:function(){var t=this;this.setState(function(o){if(!o.bybilModalVisible){var n=(0,M.isInsideOperationZone)(t.props.location);w.default.OPEN_BYBIL_MODAL({isInsideOperationZone:n})}return{bybilModalVisible:!o.bybilModalVisible}})}},{key:"checkForMatchingStation",value:function(t){var o,n,s=this,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=this.removeSelectedStations(this.props.stations),c=(0,b.filterStationsByQuery)(u,t);if(1===c.length&&c[0].active){var f=(n=1,L(o=c)||I(o,n)||F())[0],h=f.name,p=!1;if(l){var y=new RegExp('^'+t.trim(),'gi');p=!!f.name.match(y)}else{var S=new RegExp('^'+h+'$','gi');p=!!t.trim().match(S)}p&&(0,k.default)(function(){return s.onStationSelected(f)},300)()}}},{key:"render",value:function(){var w,O,k,j=this,q=this.removeSelectedStations(this.props.stations),F=this.removeSelectedStations(this.props.favoriteStations),I=this.removeSelectedStations(this.props.recentSearch),L=(0,b.filterStationsByQuery)(q,this.state.query),R=(0,b.sortStationsByQuery)(L,this.state.query),x=(0,b.findNearbyStations)(q,this.props.location).map(Y),D=F.map(function(t){return Y(t,'favorite')}).concat(I.map(Y)),Q=(0,E.removeDuplicates)(D,'key'),z=1===R.length&&!R[0].active,N=R.length>0&&this.state.query.length>0&&!z,W=this.state.query.length>0&&0===R.length&&!this.state.toStation,Z=!this.state.query.length,G=R[0]&&R[0].message,H=!N&&!W&&!z&&!this.state.fromStation&&(null==(w=this.props.featureToggles)?void 0:w.showBybil);return t.createElement(t.Fragment,null,t.createElement(V.default,{toActive:function(){j.props.onRequestStatus()}}),t.createElement(o.SafeAreaView,null,t.createElement(o.TouchableWithoutFeedback,{onPress:function(){return o.Keyboard.dismiss()},accessible:!1},t.createElement(o.View,{style:A.default.stationSearchBodyWrapper},t.createElement(o.View,{style:{flexDirection:'row',justifyContent:'space-between',alignItems:'center'}},t.createElement(o.Image,{source:B.vyLogo,style:{height:60,width:60,marginLeft:24,marginTop:12},resizeMode:"contain"}),this.props.betaToggleOn&&t.createElement(T.default,{onPress:this.props.onSwitchSearchMode,searchModeIsBeta:!1})),(null==(O=this.props.tickerMessages)?void 0:O.frontpageMessage)&&t.createElement(C.default,{tickerMessage:this.props.tickerMessages.frontpageMessage,containerStyle:{marginHorizontal:24}}),t.createElement(o.View,{style:{flex:1}},t.createElement(s.default,{query:this.state.query,onClear:function(){return j.handleClearQuery()},hasDepartureStation:void 0!==this.state.fromStation,onReturnPressed:function(){return j.checkForMatchingStation(j.state.query,!0)},onInputChange:function(t){j.handleQueryChanged(t),j.checkForMatchingStation(t)},label:t.createElement(o.View,{style:{flexDirection:'row',justifyContent:'space-between'}},t.createElement(u.default,{departureStation:this.state.fromStation,onPress:this.handleClearFromStation}),this.state.showClearButton&&t.createElement(h.CancelButton,{onPress:this.resetSearch,text:(0,v.default)('cancel_search'),color:_.default.actionGreen,style:{margin:0}}))}),N&&t.createElement(o.View,{style:{flex:1}},t.createElement(f.default,{stations:R.filter(function(t){return t.active}).sort(function(t,o){return(0,b.sortByType)(t,o,j.state.typeActive)}),fromStation:this.state.fromStation,onStationSelected:function(t){return j.onStationSelected(t)},toggleErrorModalVisible:this.toggleErrorModalVisible,isErrorModalVisible:this.state.isErrorModalVisible,useBetaTravelPlanner:this.props.useBetaTravelPlanner})),z&&t.createElement(o.View,{style:A.default.noSearchResultsMessageWrapper},t.createElement(c.default,{message:G})),W&&t.createElement(o.View,{style:A.default.noSearchResultsMessageWrapper},t.createElement(c.default,{message:(0,v.default)('no_stations_found_with_query')})),Z&&t.createElement(l.default,{nearbyStations:x,shortcutStations:Q,fromStation:this.state.fromStation,locationAuthorization:this.props.locationAuthorization,onRequestLocationPermission:this.props.onRequestLocationPermission,onSelectStation:function(t){return j.onStationSelected(t)},onDeleteStation:function(t){return j.props.onDeleteStation(t)},toggleErrorModalVisible:this.toggleErrorModalVisible,isErrorModalVisible:this.state.isErrorModalVisible}),(null==(k=this.props.featureToggles)?void 0:k.showTaxi)&&t.createElement(P.default,{navigation:this.props.navigation}),H&&t.createElement(p.default,{isInsideOperationZone:(0,M.isInsideOperationZone)(this.props.location),toggleModal:this.toggleBybilModal})),t.createElement(S.default,null),'Android'===o.Platform.OS&&o.Platform.Version<21&&t.createElement(y.default,null),t.createElement(n.default,{isVisible:this.state.bybilModalVisible,onClose:this.toggleBybilModal,locationAuthorization:this.props.locationAuthorization})))))}}])&&D(q.prototype,W),Z&&D(q,Z),j})(),Y=function(t,o){return{key:t.name,station:t,icon:o}},G=(0,O.default)(Z);e.default=G},1393,[7,10,1394,1437,1439,1443,1449,1450,658,1451,1452,1453,1234,1446,619,1400,1294,1454,1455,1438,675,415,983,1456,1458,616,1459]);