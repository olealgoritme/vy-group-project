__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=j();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var l=s?Object.getOwnPropertyDescriptor(t,c):null;l&&(l.get||l.set)?Object.defineProperty(o,c,l):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),c=r(d[4]),l=N(r(d[5])),u=N(r(d[6])),f=N(r(d[7])),k=N(r(d[8])),p=N(r(d[9])),h=N(r(d[10])),v=N(r(d[11])),T=N(r(d[12])),y=N(r(d[13])),_=N(r(d[14])),w=N(r(d[15])),b=r(d[16]),E=r(d[17]),S=r(d[18]),C=N(r(d[19])),O=N(r(d[20])),R=r(d[21]),P=N(r(d[22])),B=N(r(d[23])),I=r(d[24]),x=r(d[25]),V=r(d[26]);function N(t){return t&&t.__esModule?t:{default:t}}function j(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return j=function(){return t},t}function A(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function D(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Z(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&F(t,n)}function F(t,n){return(F=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var U=(function(N){function j(t){var n,o,s;return A(this,j),o=this,(n=!(s=M(j).call(this,t))||"object"!=typeof s&&"function"!=typeof s?H(o):s).state={itinerary:[],random:0,isRefreshing:!1,ticketBodyHeight:0,isBetaTesterSeatReservationRegionOst:!1,showInspection:!1,isCreatingRenewPeriodTicketOrder:!1},n.onTicketStateChange=n.onTicketStateChange.bind(H(n)),n.handleInspectionClicked=n.handleInspectionClicked.bind(H(n)),n.navigateToBuyZoneExtensionTicketView=n.navigateToBuyZoneExtensionTicketView.bind(H(n)),n.renewPeriodTicket=n.renewPeriodTicket.bind(H(n)),n}var F,U,W;return Z(j,t.Component),F=j,(U=[{key:"componentDidMount",value:function(){var t=this.props.navigation.state.params.ticket,n=t.ticketId,o=t.isBusTicket;(0,E.logTicketDetailsShown)(n),o||this.getItinerary()}},{key:"getItinerary",value:function(){var t=this;(0,b.getInformationForTicket)(this.props.navigation.state.params.ticket.ticketId).then(function(n){return t.setItinerary(n)}).catch(function(t){return console.log(t)}).done(function(){return t.setState({isRefreshing:!1})})}},{key:"setItinerary",value:function(t){n.LayoutAnimation.configureNext((0,V.getDefaultAnimationConfig)()),this.setState({itinerary:t})}},{key:"refresh",value:function(){this.setState({isRefreshing:!0}),this.getItinerary()}},{key:"onTicketStateChange",value:function(){this.forceUpdate()}},{key:"scrollToBeginningOfSeatReservation",value:function(){var t=this.state.ticketBodyHeight;this._scrollView&&t>0&&this._scrollView.scrollTo({y:t-30})}},{key:"shouldDisplaySeatReservation",value:function(t){var n=!(0,R.belongsToOtherDevice)(t)&&!(0,R.isCancelledOrExpired)(t),o=(0,R.isPeriodTicketWithSeatReservations)(t)||this.state.isBetaTesterSeatReservationRegionOst&&(0,R.isPeriodTicket)(t);return n&&o}},{key:"handleInspectionClicked",value:function(){this.setState({showInspection:!this.state.showInspection})}},{key:"componentDidUpdate",value:function(t,n){n.showInspection&&((0,R.isActive)(this.props.navigation.state.params.ticket)||this.setState({showInspection:!1}))}},{key:"navigateToBuyZoneExtensionTicketView",value:function(){var t=this.props.navigation,n=t.state.params.ticket;(0,R.isRuterTicket)(n)&&t.navigate('TicketChooserScreen',{ticketType:'EXTRA_ZONES',operator:'RUTER',goBackParams:{routeName:t.state.routeName,key:t.state.key}})}},{key:"renewPeriodTicket",value:function(){var t,o,l,u,f;return regeneratorRuntime.async(function(k){for(;;)switch(k.prev=k.next){case 0:if(t=this.props.navigation.state.params.ticket,o=t.topologyReferenceCode&&t.productVersionCode,t.validTo&&(o||8===t.orderId.length)){k.next=4;break}return k.abrupt("return");case 4:return k.prev=4,this.setState({isCreatingRenewPeriodTicketOrder:!0}),k.next=8,regeneratorRuntime.awrap((0,s.renewPeriodTicket)(t.productVersionCode,t.orderId,t.topologyReferenceCode,t.validTo));case 8:return l=k.sent,u=l.id,k.next=12,regeneratorRuntime.awrap((0,s.getOrder)(u));case 12:f=k.sent,this.props.navigation.navigate('PeriodTicketOrderConfirmation',{orderId:u,order:f,previousStack:{routeName:this.props.navigation.state.routeName,key:this.props.navigation.state.key,firstRouteName:'Tickets'}}),k.next=19;break;case 16:k.prev=16,k.t0=k.catch(4),n.Alert.alert((0,P.default)('order_or_payment_failed_alert_title'),(0,c.getMessageFromErrorIfPresent)(k.t0)||(0,P.default)('renew_season_ticket_failed_generic_message'));case 19:return k.prev=19,this.setState({isCreatingRenewPeriodTicketOrder:!1}),k.finish(19);case 22:case"end":return k.stop()}},null,this,[[4,16,19,22]])}},{key:"render",value:function(){var s=this,c=this.props.navigation,b=c.state.params.ticket,V=this.state,N=V.itinerary,j=V.isCreatingRenewPeriodTicketOrder,A=b.legs.map(function(t){return t.stationFrom}),D=!!b.stationFrom&&b.stationTo,M=((0,R.isPeriodTicket)(b)||(0,R.isHereAndNowTicket)(b)||(0,R.isSingleTicket)(b)&&(0,R.isRuterTicket)(b))&&(0,R.isActive)(b)&&!(0,R.isEmployeeTicket)(b)&&!(0,R.isCancelledOrExpired)(b)&&!(0,R.belongsToOtherDevice)(b)&&!(0,I.isZoneExtensionTicket)(b)&&(0,R.isRuterTicket)(b)&&b.topologyReferenceCode,H=(0,R.isPeriodTicket)(b)||(0,R.isHereAndNowTicket)(b)?v.default:h.default,Z=null,F=(0,R.ticketCanBeRenewed)(b)&&L(b),U=(0,R.isSingleTicket)(b)&&!(0,R.isHereAndNowTicket)(b),W=this.shouldDisplaySeatReservation(b),X=(0,R.isValid)(b)||(0,R.isValidLaterToday)(b)||(0,R.isBusTicket)(b);return(N.length>0&&(0,B.default)().diff(N[N.length-1].arrivalTime,'hours')>4||(0,R.isRuterTicket)(b))&&((0,R.isCancelledOrExpired)(b)||(0,R.belongsToOtherDevice)(b))?(0,R.isPeriodTicket)(b)||(0,R.isHereAndNowTicket)(b)?Z=t.default.createElement(y.default,{ticket:b,navigation:c}):(0,R.isSingleTicket)(b)?Z=t.default.createElement(T.default,{ticket:b,navigation:c}):(0,E.logRenderingUnknownTicketType)(b.ticketId):Z=(0,R.isPeriodTicket)(b)||(0,R.isHereAndNowTicket)(b)?t.default.createElement(_.default,{ticket:b,onTicketStateChange:this.onTicketStateChange}):t.default.createElement(k.default,{ticket:b,itinerary:N,onTicketStateChange:this.onTicketStateChange,shouldDisplayAddToCalendarButton:U}),t.default.createElement(n.ScrollView,{ref:function(t){return s._scrollView=t},style:u.default.container,refreshControl:(0,R.isSingleTicket)(b)?t.default.createElement(n.RefreshControl,{refreshing:this.state.isRefreshing,onRefresh:function(){return s.refresh()}}):null},t.default.createElement(l.default,{toActive:function(){s.setState({random:s.state.random+1})}}),t.default.createElement(n.View,{onLayout:W?function(t){return s.setState({ticketBodyHeight:t.nativeEvent.layout.height})}:void 0},t.default.createElement(H,{ticket:b,viaStations:A,onTicketStateChange:this.onTicketStateChange,onInspectionClicked:this.handleInspectionClicked}),Z),W&&t.default.createElement(w.default,{ticket:b,navigation:c,scrollToBeginningOfSeatReservation:function(){return s.scrollToBeginningOfSeatReservation()}}),F&&t.default.createElement(n.View,{style:u.default.alternativesButtons},t.default.createElement(C.default,{loading:j,disabled:j,onPress:this.renewPeriodTicket},(0,P.default)('renew_period_ticket'))),M&&t.default.createElement(n.View,{style:u.default.alternativesButtons},t.default.createElement(C.default,{onPress:this.navigateToBuyZoneExtensionTicketView},(0,P.default)('buy_extension_ticket'))),(0,R.isBusTicket)(b)&&t.default.createElement(n.View,{style:{padding:24}},t.default.createElement(x.MediumTextBold,{style:{marginBottom:12}},(0,P.default)('ticket_details_bus_receipt_header')),t.default.createElement(x.MediumText,null,(0,P.default)('ticket_details_bus_receipt_text'))),(0,R.isPeriodTicket)(b)&&D&&t.default.createElement(S.NavigationButton,{action:function(){return c.navigate({routeName:'FavoritesStack',action:o.StackActions.popToTop()})},text:(0,P.default)('ticket_details_link_subscriptions'),addBottomSeparator:!0}),!(0,R.isBusTicket)(b)&&t.default.createElement(S.NavigationButton,{action:function(){return c.navigate('TicketReceipt',{ticket:b})},text:(0,P.default)('ticket_details_link_receipt'),addBottomSeparator:!0}),(0,R.isCancellable)(b)&&t.default.createElement(S.NavigationButton,{action:function(){return c.navigate('CancelTicket',{ticket:b})},text:(0,P.default)('ticket_details_link_cancel'),addBottomSeparator:!0}),t.default.createElement(f.default,null),t.default.createElement(p.default,null),X&&t.default.createElement(O.default,{key:b.ticketId,ticket:b,location:"billettdetaljer",isVisible:this.state.showInspection,onClose:this.handleInspectionClicked}))}}])&&D(F.prototype,U),W&&D(F,W),j})();function L(t){if((0,R.isEmployeeTicket)(t))return!1;var n=(0,B.default)(t.validTo),o=(0,B.default)().subtract(30,'days'),s=(0,B.default)().add(5,'days');return n.isBefore(s)||(0,R.isCancelledOrExpired)(t)&&n.isAfter(o)}U.navigationOptions=function(t){t.navigation;return{headerTitle:(0,P.default)('ticket_details_title_bar')}};var W=U;e.default=W},1653,[7,10,435,642,636,1455,1654,1176,1655,1288,1672,1674,1675,1677,1664,1678,662,661,658,1178,1567,669,673,628,669,962,1689]);