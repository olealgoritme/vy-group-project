__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=R();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var u=s?Object.getOwnPropertyDescriptor(t,c):null;u&&(u.get||u.set)?Object.defineProperty(o,c,u):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=y(r(d[3])),c=y(r(d[4])),u=r(d[5]),l=r(d[6]),f=r(d[7]),p=y(r(d[8])),v=y(r(d[9])),_=y(r(d[10]));function y(t){return t&&t.__esModule?t:{default:t}}function R(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return R=function(){return t},t}function h(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function D(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&S(t,n)}function S(t,n){return(S=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var k=(function(y){function R(t){var n,o,s;return h(this,R),o=this,(n=!(s=b(R).call(this,t))||"object"!=typeof s&&"function"!=typeof s?O(o):s).state={isFetchingReservationData:!0,reservationData:void 0,informationVisible:!1,appDeprecated:!1,appDeprecatedMessage:''},n.navigateToSeatDepartures=n.navigateToSeatDepartures.bind(O(n)),n}var S,k,E;return w(R,t.Component),S=R,(k=[{key:"componentDidMount",value:function(){this.fetchReservationData()}},{key:"fetchReservationData",value:function(){var t;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return this.setState({isFetchingReservationData:!0}),o.prev=1,o.next=4,regeneratorRuntime.awrap((0,l.getReservationDataForTicket)(this.props.ticket.ticketId));case 4:t=o.sent,this.setReservationData(t),o.next=12;break;case 8:o.prev=8,o.t0=o.catch(1),this.setState({isFetchingReservationData:!1,appDeprecated:'FAILED_OLD_APP_VERSION'===o.t0.status||!1,appDeprecatedMessage:o.t0.message||''}),n.Alert.alert((0,c.default)('could_not_retrieve_reservations_title'),(0,c.default)('could_not_retrieve_reservations_message'));case 12:case"end":return o.stop()}},null,this,[[1,8]])}},{key:"setReservationData",value:function(t){this.setState({isFetchingReservationData:!1,reservationData:{journeyReservations:t.journeyReservations.sort(f.sortByDepartureTime)}})}},{key:"cancelReservation",value:function(t){return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,regeneratorRuntime.awrap((0,l.cancelReservation)(t));case 3:o.next=8;break;case 5:o.prev=5,o.t0=o.catch(0),n.Alert.alert((0,c.default)('could_not_cancel_seat_alert_title'),o.t0.message||(0,c.default)('could_not_cancel_seat_alert_default_message'));case 8:this.fetchReservationData(),s.default.CANCELLED_SEAT_RESERVATION_FOR_JOURNEY({reservationId:JSON.stringify({reservationId:t})});case 10:case"end":return o.stop()}},null,this,[[0,5]])}},{key:"cancelReservationForLeg",value:function(t,o){return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,regeneratorRuntime.awrap((0,l.cancelReservationForLeg)(t,o));case 3:u.next=8;break;case 5:u.prev=5,u.t0=u.catch(0),n.Alert.alert((0,c.default)('could_not_cancel_seat_alert_title'),u.t0.message||(0,c.default)('could_not_cancel_seat_alert_default_message'));case 8:s.default.CANCELLED_SEAT_RESERVATION_FOR_LEG({legIdentifier:JSON.stringify({legIdentifier:o})});case 9:case"end":return u.stop()}},null,null,[[0,5]])}},{key:"handleCancelReservation",value:function(t){var o=this;n.Alert.alert((0,c.default)('cancel_seat_reservation_alert_title'),(0,c.default)('cancel_seat_reservation_alert_message'),[{text:(0,c.default)('alert_negative_button')},{text:(0,c.default)('alert_positive_button'),style:'cancel',onPress:function(){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(o.cancelReservation(t));case 2:n.sent&&setTimeout(function(){o.props.scrollToBeginningOfSeatReservation()},500);case 4:case"end":return n.stop()}})}}],{cancelable:!1})}},{key:"toggleSeatReservationInformation",value:function(){this.setState(function(t){return{informationVisible:!t.informationVisible}})}},{key:"navigateToSeatDepartures",value:function(){var t=this;this.props.navigation.navigate('SeatReservationDepartures',{ticket:this.props.ticket,updateReservationData:function(n){return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(t.setReservationData(n));case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}})},onCancelReservation:function(n,o){return t.cancelReservationForLeg(n,o)},onClose:function(){var n=o.NavigationActions.navigate({routeName:'Tickets',key:t.props.navigation.state.key});t.props.navigation.dispatch(n)}})}},{key:"render",value:function(){var o,s=this,c=this.state,l=c.informationVisible,f=c.isFetchingReservationData,y=c.reservationData,R=c.appDeprecated,h=c.appDeprecatedMessage,D=null!=(o=null==y?void 0:y.journeyReservations)?o:[],b=D.length>0,O=D.filter(function(t){return(0,p.default)().isSame(t.departureTime,'day')});return t.default.createElement(n.View,null,f?t.default.createElement(n.View,{style:{alignItems:'center',marginBottom:42}},t.default.createElement(u.ActivityDotsIndicator,null)):t.default.createElement(t.default.Fragment,null,t.default.createElement(_.default,{informationVisible:l,appDeprecated:R,appDeprecatedMessage:h,seatReservationInfoVisible:!b,reservationStatusToday:O,navigateToSeatDepartures:this.navigateToSeatDepartures,toggleSeatReservationInformation:function(){return s.toggleSeatReservationInformation()}}),t.default.createElement(v.default,{journeyReservations:D,onCancelReservation:function(t){return s.handleCancelReservation(t)}})))}}])&&D(S.prototype,k),E&&D(S,E),R})();e.default=k},1678,[7,10,435,1294,673,653,1480,1622,628,1679,1685]);