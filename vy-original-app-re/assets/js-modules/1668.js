__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=f();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var u=s?Object.getOwnPropertyDescriptor(t,c):null;u&&(u.get||u.set)?Object.defineProperty(o,c,u):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),c=r(d[4]),u=h(r(d[5])),p=h(r(d[6])),l=h(r(d[7]));function h(t){return t&&t.__esModule?t:{default:t}}function f(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return f=function(){return t},t}function S(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function b(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&w(t,n)}function w(t,n){return(w=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var T=(function(h){function f(t){var n,o,s;return S(this,f),o=this,(n=!(s=v(f).call(this,t))||"object"!=typeof s&&"function"!=typeof s?y(o):s).hasSetUp=!1,n.state={hasSubscriptionForStationPair:!1,pushSwitchDisabled:!1,pushSwitchState:!1,showPush:!1},n.navigateToFavoritesAndResetBooking=n.navigateToFavoritesAndResetBooking.bind(y(n)),n}var w,T,P;return k(f,t.Component),w=f,(T=[{key:"componentDidUpdate",value:function(){if(!this.hasSetUp&&this.props.orderId&&this.props.ticketType)switch(this.hasSetUp=!0,this.props.ticketType){case'ENKELTBILLETT':this.findOrCreateSingleTicketPushSubscription(this.props.orderId);break;case'PERIODEBILLETT':this.fetchPeriodTicketSubscriptions()}}},{key:"findOrCreateSingleTicketPushSubscription",value:function(t){this.props.tripId?this.createSingleTicketPushSubscription(t):this.findExistingSubscription(t)}},{key:"findExistingSubscription",value:function(t){var n;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,regeneratorRuntime.awrap((0,s.getSubscriptionByOrderId)(t));case 3:n=o.sent,this.setState({pushSwitchState:!!n.active,showPush:!0}),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),console.log('Could not find existing subscription for orderId = '+t);case 10:case"end":return o.stop()}},null,this,[[0,7]])}},{key:"createSingleTicketPushSubscription",value:function(t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap((0,s.createSubscription)(this.props.tripId,t));case 3:console.log('Push subscription created'),this.setState({showPush:!0,pushSwitchState:!0}),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.log('Could not create push subscription: '+JSON.stringify(n.t0));case 10:case"end":return n.stop()}},null,this,[[0,7]])}},{key:"fetchPeriodTicketSubscriptions",value:function(){var t,n,o,c=this;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,regeneratorRuntime.awrap((0,s.fetchSubscriptions)());case 3:t=u.sent,n=t.find(function(t){return t.from.name==c.props.from&&t.to.name==c.props.to}),console.log('Subscription: '+JSON.stringify(n)),o=!!n,console.log('User has subscription from before : '+String(o)),this.setState({showPush:!0,hasSubscriptionForStationPair:o}),u.next=15;break;case 11:u.prev=11,u.t0=u.catch(0),console.log('Failed getting favorites: '+JSON.stringify(u.t0)),this.setState({showPush:!0});case 15:case"end":return u.stop()}},null,this,[[0,11]])}},{key:"enableSingleTicketPush",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap((0,s.enableSubscription)(this.props.orderId));case 3:console.log('Subscription successfully enabled for '+String(this.props.orderId)),this.setState({pushSwitchDisabled:!1}),t.next=12;break;case 7:t.prev=7,t.t0=t.catch(0),console.log('Subscription failed to enable for '+String(this.props.orderId)),this.setState({pushSwitchDisabled:!1,pushSwitchState:!1}),n.Alert.alert((0,l.default)('single_enable_failed_title'),(0,l.default)('single_enable_failed'));case 12:case"end":return t.stop()}},null,this,[[0,7]])}},{key:"disableSingleTicketPush",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap((0,s.disableSubscription)(this.props.orderId));case 3:console.log('Subscription successfully disabled for '+String(this.props.orderId)),this.setState({pushSwitchDisabled:!1}),t.next=12;break;case 7:t.prev=7,t.t0=t.catch(0),console.log('Subscription failed to disabled for '+String(this.props.orderId)),this.setState({pushSwitchDisabled:!1,pushSwitchState:!0}),n.Alert.alert((0,l.default)('single_disable_failed_title'),(0,l.default)('single_disable_failed'));case 12:case"end":return t.stop()}},null,this,[[0,7]])}},{key:"toggleSingleTicketPush",value:function(t){this.setState({pushSwitchState:t}),t?this.enableSingleTicketPush():this.disableSingleTicketPush()}},{key:"navigateToFavoritesAndResetBooking",value:function(){this.props.navigation.dispatch(o.StackActions.popToTop()),this.props.navigation.dispatch(o.NavigationActions.navigate({routeName:'BookingStack',action:o.StackActions.popToTop()})),this.props.navigation.dispatch(o.NavigationActions.navigate({routeName:'FavoritesStack',action:o.StackActions.popToTop()}))}},{key:"render",value:function(){var n=this;if(!this.state.showPush)return null;var o=this.props.ticketType,s=this.state,l=s.pushSwitchDisabled,h=s.pushSwitchState,f=s.hasSubscriptionForStationPair;return t.default.createElement(c.FadeIn,{duration:500},'PERIODEBILLETT'===o&&t.default.createElement(u.default,{hasSubscriptionForStationPair:f,navigateToFavorites:this.navigateToFavoritesAndResetBooking}),'ENKELTBILLETT'===o&&t.default.createElement(p.default,{pushSwitchState:h,onValueChange:function(t){return n.toggleSingleTicketPush(t)},disabled:l}))}}])&&b(w.prototype,T),P&&b(w,P),f})(),P=(0,o.withNavigation)(T);e.default=P},1668,[7,10,435,1635,653,1669,1671,1641]);