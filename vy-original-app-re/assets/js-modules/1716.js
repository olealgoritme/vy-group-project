__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=l(r(d[0])),s=r(d[1]),n=r(d[2]),o=r(d[3]),p=r(d[4]),u=l(r(d[5])),c=l(r(d[6]));function l(t){return t&&t.__esModule?t:{default:t}}function f(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}function h(t,s){for(var n=0;n<s.length;n++){var o=s[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),s&&P(t,s)}function P(t,s){return(P=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t})(t,s)}var k=s.NativeModules.VippsBridge,S=new s.NativeEventEmitter(k),V=(function(s){function l(t){var s,n,o;return f(this,l),n=this,(s=!(o=v(l).call(this,t))||"object"!=typeof o&&"function"!=typeof o?y(n):o).state={order:t.order},s.checkVippsPaymentStatus=s.checkVippsPaymentStatus.bind(y(s)),s.onVippsCallback=s.onVippsCallback.bind(y(s)),s.initiateVippsActivity=s.initiateVippsActivity.bind(y(s)),s}var P,V,_;return b(l,t.default.Component),P=l,(V=[{key:"componentDidMount",value:function(){var t=this;this.checkVippsPaymentStatusTimeout=setTimeout(this.checkVippsPaymentStatus,1e4),this.vippsEventSubscription=S.addListener("VIPPS_CALLBACK",function(s){return t.onVippsCallback(s)}),o.remoteLogger.info(o.sources.VIPPS,'Added event subscription',{orderId:this.state.order.id}),this.initiateVippsActivity()}},{key:"componentWillUnmount",value:function(){this.checkVippsPaymentStatusTimeout&&clearTimeout(this.checkVippsPaymentStatusTimeout),this.vippsEventSubscription&&this.vippsEventSubscription.remove(),o.remoteLogger.info(o.sources.VIPPS,'Remove event subscription',{orderId:this.state.order.id})}},{key:"initiateVippsActivity",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(k.initiatePayment(this.props.vippsUrl));case 3:t.next=9;break;case 5:t.prev=5,t.t0=t.catch(0),o.remoteLogger.info(o.sources.VIPPS,'Initiate native activity failed',{orderId:this.state.order.id}),this.props.onSetStatus({type:'ERROR',message:(0,u.default)('vipps_rejected_error_message')});case 9:case"end":return t.stop()}},null,this,[[0,5]])}},{key:"checkVippsPaymentStatus",value:function(){var t,s;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap((0,p.getOrder)(this.state.order.id));case 3:t=n.sent,s=t.paymentStatus,o.remoteLogger.info(o.sources.VIPPS,'Payment status polling',{orderId:t.id,status:s}),n.t0=s,n.next='NONE'===n.t0?9:'INITIATED'===n.t0?10:'GO_TO_CAPTURE'===n.t0?12:'CAPTURED'===n.t0?12:'REJECTED'===n.t0?14:'CREDITED'===n.t0?14:'CANCELLED'===n.t0?14:16;break;case 9:return n.abrupt("break",16);case 10:return this.checkVippsPaymentStatusTimeout=setTimeout(this.checkVippsPaymentStatus,2500),n.abrupt("break",16);case 12:return this.props.navigateToReceipt(),n.abrupt("break",16);case 14:return this.props.onSetStatus({type:'ERROR',message:(0,u.default)('vipps_rejected_error_message')}),n.abrupt("break",16);case 16:n.next=22;break;case 18:n.prev=18,n.t1=n.catch(0),this.checkVippsPaymentStatusTimeout=setTimeout(this.checkVippsPaymentStatus,2500),o.remoteLogger.error(o.sources.VIPPS,"Get order failed",{orderId:this.state.order.id,error:n.t1});case 22:case"end":return n.stop()}},null,this,[[0,18]])}},{key:"onVippsCallback",value:function(t){if(o.remoteLogger.info(o.sources.VIPPS,'Returned app switch',{orderId:this.state.order.id,url:t}),(0,n.isVippsCallback)(t)){var s=(0,n.parseVippsUrlCallback)(t,this.state.order.id);s.didError?this.props.onSetStatus({type:'ERROR',message:s.message||(0,u.default)('vipps_rejected_error_message')}):this.props.navigateToReceipt()}else{o.remoteLogger.error(o.sources.VIPPS,'Vipps callback url parsing failed',{orderId:this.state.order.id,error:"The provided URL isn't a valid Vipps-callback",url:t}),this.props.onSetStatus({type:'ERROR',message:(0,u.default)('vipps_rejected_error_message')})}}},{key:"render",value:function(){return t.default.createElement(c.default,null)}}])&&h(P.prototype,V),_&&h(P,_),l})();e.default=V},1716,[7,10,1710,633,642,1717,1718]);