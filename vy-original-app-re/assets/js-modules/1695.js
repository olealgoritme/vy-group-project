__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=S();if(n&&n.has(t))return n.get(t);var c={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=s?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(c,o,u):c[o]=t[o]}c.default=t,n&&n.set(t,c);return c})(r(d[0])),n=r(d[1]),c=T(r(d[2])),s=T(r(d[3])),o=T(r(d[4])),u=T(r(d[5])),f=T(r(d[6])),l=T(r(d[7])),p=r(d[8]),h=r(d[9]),k=r(d[10]),v=r(d[11]),_=T(r(d[12])),y=r(d[13]),O=r(d[14]),b=r(d[15]);function T(t){return t&&t.__esModule?t:{default:t}}function S(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return S=function(){return t},t}function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function E(t,n){for(var c=0;c<n.length;c++){var s=n[c];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&x(t,n)}function x(t,n){return(x=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var I=(function(T){function S(t){var n,c,s;return w(this,S),c=this,(n=!(s=R(S).call(this,t))||"object"!=typeof s&&"function"!=typeof s?j(c):s).state={refundOptions:null,refundOptionsError:null,isFetching:!0,isRefunding:!1,isTicketScannedByStaff:void 0},n.refundTicket=n.refundTicket.bind(j(n)),n}var x,I,A;return P(S,t.Component),x=S,(I=[{key:"componentDidMount",value:function(){this.getRefundOptions(),this.checkIfTicketIsScannedByStaff(),(0,h.logTicketCancelShown)(this.props.navigation.state.params.ticket.ticketId)}},{key:"getRefundOptions",value:function(){var t=this,n=this.props.navigation.state.params.ticket.ticketId;(0,p.getRefundOptionsForTicket)(n).then(function(n){return t.setState({refundOptions:n,isFetching:!1})}).catch(function(n){return t.setRefundOptionsError(n)}).done()}},{key:"checkIfTicketIsScannedByStaff",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t=this.props.navigation.state.params.ticket.ticketId,n.t0=this,n.next=5,regeneratorRuntime.awrap((0,v.isTicketScanned)(t));case 5:n.t1=n.sent,n.t2={isTicketScannedByStaff:n.t1},n.t0.setState.call(n.t0,n.t2),n.next=13;break;case 10:n.prev=10,n.t3=n.catch(0),console.log('Couldnt fetch manually inspected tickets',n.t3);case 13:case"end":return n.stop()}},null,this,[[0,10]])}},{key:"refundTicket",value:function(){var t=this,n=this.props.navigation.state.params.ticket;this.setState({isRefunding:!0}),(0,p.refundTicket)(n.ticketId).then(function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap((0,k.emptyTicketDatabaseAndRefetchTickets)());case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log('Failed to empty ticket database and refetch tickets with error: ',t.t0);case 8:case"end":return t.stop()}},null,null,[[0,5]])}).then(function(){(0,O.isSingleTicket)(n)&&(0,y.disableSubscription)(n.orderId).catch(function(){})}).then(function(){return t.createSuccessAlert()}).catch(function(n){return t.createErrorAlert(n)})}},{key:"setErrorText",value:function(t){this.setState({refundOptionsError:t})}},{key:"setRefundOptionsError",value:function(t){this.setState({isFetching:!1}),this.setErrorText(t.message||(0,_.default)('cancel_ticket_generic_error'))}},{key:"resetNavigationToTicketListScreen",value:function(){(0,b.resetToParentStackAndNavigateTo)(this.props.navigation)}},{key:"createSuccessAlert",value:function(){var t=this;this.setState({isRefunding:!1}),n.Alert.alert((0,_.default)('cancel_ticket_alert_title_on_success'),(0,_.default)('cancel_ticket_alert_message_on_success'),[{text:(0,_.default)('cancel_ticket_alert_dismiss'),onPress:function(){return t.resetNavigationToTicketListScreen()}}],{onDismiss:function(){return t.resetNavigationToTicketListScreen()}})}},{key:"createErrorAlert",value:function(){this.setState({isRefunding:!1});var t=this.props.navigation;n.Alert.alert((0,_.default)('cancel_ticket_alert_title_on_error'),(0,_.default)('cancel_ticket_alert_message_on_error'),[{text:(0,_.default)('cancel_ticket_alert_dismiss'),onPress:function(){return t.goBack(null)}}])}},{key:"render",value:function(){var n=!this.state.isFetching&&!1===this.state.isTicketScannedByStaff&&this.state.refundOptions&&!this.state.refundOptionsError,p=!this.state.isFetching&&this.state.isTicketScannedByStaff;return t.default.createElement(l.default,{style:c.default.container},t.default.createElement(o.default,{error:this.state.refundOptionsError}),this.state.isFetching&&t.default.createElement(s.default,null),n&&t.default.createElement(f.default,{isRefunding:this.state.isRefunding,refundOptions:this.state.refundOptions,handleTicketRefund:this.refundTicket,ticket:this.props.navigation.state.params.ticket,navigation:this.props.navigation}),p&&t.default.createElement(u.default,{ticketId:this.props.navigation.state.params.ticket.ticketId}))}}])&&E(x.prototype,I),A&&E(x,A),S})();I.navigationOptions=function(){return{headerTitle:(0,_.default)('cancel_ticket_title_bar')}};var A=I;e.default=A},1695,[7,10,1696,1184,1697,1699,1700,1266,662,661,1634,1626,673,1635,669,1701]);