__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=A();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var c=s?Object.getOwnPropertyDescriptor(t,u):null;c&&(c.get||c.set)?Object.defineProperty(o,u,c):o[u]=t[u]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),u=r(d[4]),c=r(d[5]),l=k(r(d[6])),f=k(r(d[7])),p=k(r(d[8])),v=k(r(d[9])),h=r(d[10]),y=r(d[11]),b=r(d[12]);function k(t){return t&&t.__esModule?t:{default:t}}function A(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return A=function(){return t},t}function F(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function P(t,n){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var o=[],s=!0,u=!1,c=void 0;try{for(var l,f=t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();!(s=(l=f.next()).done)&&(o.push(l.value),!n||o.length!==n);s=!0);}catch(t){u=!0,c=t}finally{try{s||null==f.return||f.return()}finally{if(u)throw c}}return o}}function w(t){if(Array.isArray(t))return t}function S(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function T(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function R(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_(t,n)}function _(t,n){return(_=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var I=(function(y){function k(t){var n,o,s;return S(this,k),o=this,(n=!(s=C(k).call(this,t))||"object"!=typeof s&&"function"!=typeof s?O(o):s).state={preferredPassengerCategory:void 0,employeeTicketRights:void 0,isAddingFavorite:!1,hasAddedFavorite:!1,showAddToFavoritesModal:!1},n.handleAddFavoritesModalClose=n.handleAddFavoritesModalClose.bind(O(n)),n.addToFavorites=n.addToFavorites.bind(O(n)),n.onBackButtonPressed=n.onBackButtonPressed.bind(O(n)),n}var A,_,I;return R(k,t.Component),A=k,(_=[{key:"componentDidMount",value:function(){this.getPreferredPassengerCategory(),this.askUserToAddFavoriteIfNeeded(),this.props.loginState.isLoggedIn&&this.props.loginState.userProfile.userId&&this.getEmployeeTicketRights()}},{key:"getPreferredPassengerCategory",value:function(){var t,n,s,u,c,l,f,p;return regeneratorRuntime.async(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,regeneratorRuntime.awrap((0,o.getPreferredPassengerCategory)());case 2:s=v.sent,y=1,u=w(h=s)||P(h,y)||F(),c=u[0],l=this.props.loginState.isLoggedIn?this.props.loginState.userProfile.userId:void 0,f='CUSTOMER_CARD'===(null==(t=c)?void 0:t.discount),p=l===(null==(n=c)?void 0:n.customerNumber),f&&!p&&(c=o.DEFAULT_PASSENGER,(0,o.setPreferredPassengerCategory)([c])),this.setState({preferredPassengerCategory:c});case 11:case"end":return v.stop()}var h,y},null,this)}},{key:"askUserToAddFavoriteIfNeeded",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.props.loginState.isLoggedIn){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,regeneratorRuntime.awrap((0,s.getFavoritesFromCacheThenRemote)());case 6:return t=n.sent,n.next=9,regeneratorRuntime.awrap(this.checkIfFavoriteCanBeAddedAndAskUser(t));case 9:n.next=14;break;case 11:n.prev=11,n.t0=n.catch(3),console.warn('Failed to ask user to add favorite');case 14:case"end":return n.stop()}},null,this,[[3,11]])}},{key:"checkIfFavoriteCanBeAddedAndAskUser",value:function(t){var n,o,s,c;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:if(n=this.props.navigation.state.params,o=n.from,s=n.to,(0,b.isTrainStations)(o,s)){l.next=3;break}return l.abrupt("return");case 3:return l.next=5,regeneratorRuntime.awrap((0,u.askAddToFavorite)(o,s,t));case 5:c=l.sent,this.setState({showAddToFavoritesModal:c});case 7:case"end":return l.stop()}},null,this)}},{key:"addToFavorites",value:function(t){var o,u,c=this;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,this.setState({isAddingFavorite:!0}),o=(0,b.mapStationToLegacyStation)(t.from),u=(0,b.mapStationToLegacyStation)(t.to),l.next=6,regeneratorRuntime.awrap((0,s.addFavorite)(o,u));case 6:setTimeout(function(){c.setState({hasAddedFavorite:!0,isAddingFavorite:!1})},500),setTimeout(function(){c.handleAddFavoritesModalClose()},1200),l.next=13;break;case 10:l.prev=10,l.t0=l.catch(0),n.Alert.alert((0,v.default)('add_favorite_failed_title'),(0,v.default)('add_favorite_failed_text'),[{text:'Ok',onPress:function(){c.handleAddFavoritesModalClose(),c.setState({isAddingFavorite:!1})}}]);case 13:case"end":return l.stop()}},null,this,[[0,10]])}},{key:"getEmployeeTicketRights",value:function(){var t,n;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.props.loginState.isLoggedIn){o.next=2;break}return o.abrupt("return");case 2:return t=this.props.loginState.userProfile.userId,o.prev=3,o.next=6,regeneratorRuntime.awrap((0,s.fetchEmployeeTicketRights)(t));case 6:n=o.sent,this.setState({employeeTicketRights:n}),o.next=13;break;case 10:o.prev=10,o.t0=o.catch(3),console.log('Failed to fetch employee ticket rights');case 13:case"end":return o.stop()}},null,this,[[3,10]])}},{key:"handleAddFavoritesModalClose",value:function(){this.setState({showAddToFavoritesModal:!1})}},{key:"onBackButtonPressed",value:function(){this.props.navigation.goBack()}},{key:"render",value:function(){var n=this.props.navigation.state.params,o=n.from,s=n.to,u=this.props.loginState.isLoggedIn?{isLoggedIn:this.props.loginState.isLoggedIn,userId:this.props.loginState.userProfile.userId}:{isLoggedIn:!1,userId:void 0},v=u.isLoggedIn,y=u.userId,b=this.state,k=b.employeeTicketRights,A=b.preferredPassengerCategory;return t.default.createElement(c.ScreenView,{style:{backgroundColor:h.colors.brightGrey}},t.default.createElement(p.default,{preferredPassengerCategory:A,customerNumber:y,isLoggedIn:v,employeeTicketRights:k,onBackButtonPressed:this.onBackButtonPressed}),t.default.createElement(l.default,{isVisible:this.state.showAddToFavoritesModal,onRequestClose:this.handleAddFavoritesModalClose},t.default.createElement(f.default,{from:o,to:s,onClose:this.handleAddFavoritesModalClose,addFavorite:this.addToFavorites,isAddingFavorite:this.state.isAddingFavorite,hasAddedFavorite:this.state.hasAddedFavorite})))}}])&&T(A.prototype,_),I&&T(A,I),k})(),x=(0,y.withLoginState)(I);x.navigationOptions=function(t){t.navigation;return{header:null}};var M=x;e.default=M},611,[7,10,612,616,645,653,1271,1291,1293,1234,414,637,1331]);