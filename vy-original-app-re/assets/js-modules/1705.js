__d(function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.navigateToScreen=function(t){return o.NavigationActions.navigate({routeName:x,params:t})},e.default=void 0;var t=(function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=S();if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var l=s?Object.getOwnPropertyDescriptor(t,c):null;l&&(l.get||l.set)?Object.defineProperty(o,c,l):o[c]=t[c]}o.default=t,n&&n.set(t,o);return o})(r(d[0])),n=r(d[1]),o=r(d[2]),s=r(d[3]),c=r(d[4]),l=r(d[5]),u=r(d[6]),f=r(d[7]),p=O(r(d[8])),y=O(r(d[9])),h=r(d[10]),v=O(r(d[11])),k=O(r(d[12])),w=r(d[13]),T=r(d[14]),b=r(d[15]);function O(t){return t&&t.__esModule?t:{default:t}}function S(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return S=function(){return t},t}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function B(t,n){if(("function"==typeof Symbol?Symbol.iterator:"@@iterator")in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var o=[],s=!0,c=!1,l=void 0;try{for(var u,f=t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();!(s=(u=f.next()).done)&&(o.push(u.value),!n||o.length!==n);s=!0);}catch(t){c=!0,l=t}finally{try{s||null==f.return||f.return()}finally{if(c)throw l}}return o}}function _(t){if(Array.isArray(t))return t}function P(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function F(t,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&V(t,n)}function V(t,n){return(V=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var x='Receipt';var j=(function(o){function O(t){var n,o,s;return P(this,O),o=this,(n=!(s=I(O).call(this,t))||"object"!=typeof s&&"function"!=typeof s?R(o):s)._accessibilityFocusText=null,n.handleBackButtonPressed=function(){return!0},n.state={ticketsDownloaded:!1,ticketsDownloadFailed:!1},n.handleBackButtonPressed=n.handleBackButtonPressed.bind(R(n)),n.closeToStartOver=n.closeToStartOver.bind(R(n)),n.goToTicketsViewAndResetBookingView=n.goToTicketsViewAndResetBookingView.bind(R(n)),n}var S,V,x;return A(O,t.Component),S=O,(V=[{key:"componentDidMount",value:function(){var t=this.props.navigation.state.params,o=t.activeTabIndex,s=t.orderId,l=t.origin,f=D(o)||l||'UNKNOWN';(0,c.trackPaymentFlowSilently)({source:'RECEIPT_MOUNTED',orderId:s,message:"purchaseOrigin: "+f+", is newPurchaseFlow"}),n.BackHandler.addEventListener('hardwareBackPress',this.handleBackButtonPressed),this.captureMoneyForOrder(s,f);var p=(0,n.findNodeHandle)(this._accessibilityFocusText);(0,u.setAccessibilityFocus)(p),n.Platform.select({ios:function(){return n.StatusBar.setBarStyle('light-content',!0)},android:function(){}})()}},{key:"componentWillUnmount",value:function(){n.Platform.select({android:function(){},ios:function(){return(0,h.setStatusBarStyleDark)()}})(),n.BackHandler.removeEventListener('hardwareBackPress',this.handleBackButtonPressed)}},{key:"captureMoneyForOrder",value:function(t,n){return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return(0,c.trackPaymentFlowSilently)({source:'CAPTURE_INITIATED',orderId:t,message:"purchaseOrigin: "+n}),o.prev=1,o.next=4,regeneratorRuntime.awrap((0,c.capture)(t));case 4:this.fetchTicketsFromServer(),o.next=11;break;case 7:o.prev=7,o.t0=o.catch(1),this.props.navigation.state.params.onCaptureFailed(o.t0),(0,c.trackPaymentFlowSilently)({source:'CAPTURE_FAILED',orderId:t});case 11:case"end":return o.stop()}},null,this,[[1,7]])}},{key:"fetchTicketsFromServer",value:function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap((0,s.fetchActiveTickets)());case 3:t=n.sent,this.handleTicketsReceived(t),n.next=12;break;case 7:n.prev=7,n.t0=n.catch(0),this.setState({ticketsDownloadFailed:!0}),console.log('Tickets failed to download: '+JSON.stringify(n.t0)),b.remoteLogger.error(b.sources.TICKETS,'Ticket download call after purchase failed',{error:n.t0});case 12:case"end":return n.stop()}},null,this,[[0,7]])}},{key:"handleTicketsReceived",value:function(t){var o=this,s=this.props.navigation.state.params.orderId,c=t.filter(function(t){return t.isNew});if(0===c.length)return b.remoteLogger.error(b.sources.TICKETS,'Missing ticket when downloading immediately after purchase',{response:t,orderId:s}),this.setState({ticketsDownloadFailed:!0});var l,f,p=(f=1,_(l=c)||B(l,f)||E())[0];this.setState({orderId:p.orderId,ticketType:p.ticketType,ticketsDownloaded:!0},function(){(0,T.incrementBadgeCountForTab)(w.TicketsStack),setTimeout(function(){var t=(0,n.findNodeHandle)(o._accessibilityFocusText);(0,u.setAccessibilityFocus)(t)},1e3)})}},{key:"closeToStartOver",value:function(){var t=this.props.navigation,n=t.state.params.previousStack;t.navigate({routeName:n.firstRouteName})}},{key:"goToTicketsViewAndResetBookingView",value:function(){this.closeToStartOver(),this.props.navigation.navigate({routeName:'Tickets'})}},{key:"render",value:function(){var o=this;if(this.state.ticketsDownloadFailed)return t.default.createElement(p.default,{navigateToTickets:this.goToTicketsViewAndResetBookingView});var s={paddingTop:(0,l.isAndroid)()?0:10},c=this.props.navigation.state.params,u=c.tripId,h=c.from,w=void 0===h?'':h,T=c.to,b=void 0===T?'':T,O=c.operator,S=void 0===O?'':O,E=c.origin,B={from:w,to:b,operator:S},_=(u||'RUTER'!==B.operator)&&'VY_BUS'!==E;return t.default.createElement(f.ScreenView,{style:v.default.screenView},t.default.createElement(n.SafeAreaView,null,t.default.createElement(n.ScrollView,{contentContainerStyle:{flexGrow:1}},t.default.createElement(n.View,{style:[v.default.content,s]},t.default.createElement(n.View,{style:[v.default.receiptContentContainer,{paddingBottom:50}]},t.default.createElement(n.View,{style:v.default.progressContainer,accessibilityLabel:this.state.ticketsDownloaded?(0,k.default)('ticket_downloaded'):(0,k.default)('processing_payment'),ref:function(t){return o._accessibilityFocusText=t},accessible:!0},t.default.createElement(f.CheckMarkProgress,{finishAnimation:this.state.ticketsDownloaded,white:!0,label:this.state.ticketsDownloaded?t.default.createElement(f.LargeTextBold,{white:!0,center:!0,numberOfLines:2},(0,k.default)('ticket_downloaded')):t.default.createElement(f.LargeTextBold,{white:!0,center:!0,numberOfLines:2},(0,k.default)('processing_payment'))})),this.state.ticketsDownloaded&&t.default.createElement(f.FadeIn,{duration:500},t.default.createElement(n.View,{style:v.default.navigationButtons},t.default.createElement(f.PrimaryButton,{onPress:this.goToTicketsViewAndResetBookingView,containerStyle:{width:'100%'}},t.default.createElement(f.MediumTextBold,{white:!0},(0,k.default)('go_to_tickets'))),t.default.createElement(n.TouchableOpacity,{onPress:this.closeToStartOver,style:v.default.startOverButton,accessibilityRole:"button"},t.default.createElement(f.MediumTextBold,{white:!0},(0,k.default)('new_booking')," \u2192")))),_&&t.default.createElement(y.default,{orderId:this.state.orderId,ticketType:this.state.ticketType,tripId:u,from:B.from,to:B.to}))))))}}])&&F(S.prototype,V),x&&F(S,x),O})();j.navigationOptions=function(){return{headerTitle:(0,k.default)('title_bar'),gesturesEnabled:!1}};var D=function(t){switch(t){case 0:return'From Booking';case 1:return'From Ruter/Kolumbus';case 3:return'From Favorites';default:return null}},C=j;e.default=C},1705,[7,10,435,662,642,968,979,653,1706,1668,632,1708,1641,1331,1646,633]);